!function(){var e={606:function(e){var t,n,i,r=e.exports={};function defaultSetTimout(){throw Error("setTimeout has not been defined")}function defaultClearTimeout(){throw Error("clearTimeout has not been defined")}!function(){try{t="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){t=defaultSetTimout}try{n="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){n=defaultClearTimeout}}();function runTimeout(e){if(t===setTimeout)return setTimeout(e,0);if((t===defaultSetTimout||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function runClearTimeout(e){if(n===clearTimeout)return clearTimeout(e);if((n===defaultClearTimeout||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}var s=[],o=!1,a=-1;function cleanUpNextTick(){if(o&&i){o=!1;i.length?s=i.concat(s):a=-1;s.length&&drainQueue()}}function drainQueue(){if(!o){var e=runTimeout(cleanUpNextTick);o=!0;for(var t=s.length;t;){i=s;s=[];for(;++a<t;)i&&i[a].run();a=-1;t=s.length}i=null;o=!1;runClearTimeout(e)}}r.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.push(new Item(e,t));1!==s.length||o||runTimeout(drainQueue)};function Item(e,t){this.fun=e;this.array=t}Item.prototype.run=function(){this.fun.apply(null,this.array)};r.title="browser";r.browser=!0;r.env={};r.argv=[];r.version="";r.versions={};function noop(){}r.on=noop;r.addListener=noop;r.once=noop;r.off=noop;r.removeListener=noop;r.removeAllListeners=noop;r.emit=noop;r.prependListener=noop;r.prependOnceListener=noop;r.listeners=function(e){return[]};r.binding=function(e){throw Error("process.binding is not supported")};r.cwd=function(){return"/"};r.chdir=function(e){throw Error("process.chdir is not supported")};r.umask=function(){return 0}}},t={};function __webpack_require__(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,__webpack_require__),r.exports}!function(){__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}()}();!function(){var e=__webpack_require__.u,t=__webpack_require__.e,n={},i={};__webpack_require__.u=function(t){return e(t)+(n.hasOwnProperty(t)?"?"+n[t]:"")};__webpack_require__.e=function(r){return t(r).catch(function(t){var s=i.hasOwnProperty(r)?i[r]:2;if(s<1){var o=e(r);t.message="Loading chunk "+r+" failed after 2 retries.\n("+o+")";t.request=o;throw t}return new Promise(function(e){var t=2-s+1;setTimeout(function(){var o="&retry-attempt="+t;n[r]="cache-bust=true"+o;i[r]=s-1;e(__webpack_require__.e(r))},function(){return 0}(t))})})}}();!function(){"use strict";var e,t,n,i,r,s,o,a,c,l,u,h,f,d,_,p,v,y=__webpack_require__(606);function _classCallCheck(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ownKeys$2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread$2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$2(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$2(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function createClientFailure(t,n){switch(t){case e.TRANSPORT_NOT_SUPPORTED:return _objectSpread$2({code:e.TRANSPORT_NOT_SUPPORTED,message:"transport not supported"},n);case e.MALFORMED_URL:return _objectSpread$2({code:e.MALFORMED_URL,message:"malformed url"},n);case e.UNAUTHENTICATED:return _objectSpread$2({code:e.UNAUTHENTICATED,message:"unauthenticated"},n)}}!function(e){e[e.TRANSPORT_NOT_SUPPORTED=1]="TRANSPORT_NOT_SUPPORTED";e[e.MALFORMED_URL=2]="MALFORMED_URL";e[e.UNAUTHENTICATED=3]="UNAUTHENTICATED"}(e||(e={}));function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArrayLimit(e,t){var n,i,r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var s=[],o=!0,a=!1;try{for(r=r.call(e);!(o=(n=r.next()).done);o=!0){s.push(n.value);if(t&&s.length===t)break}}catch(e){a=!0;i=e}finally{try{o||null==r.return||r.return()}finally{if(a)throw i}}return s}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(e,t)}}function _nonIterableRest(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}!function(e){e.WEB_SOCKETS_NOT_SUPPORTED="web_socket_not_supported";e.WEB_SOCKET_ERROR="web_socket_error";e.CLIENT_OFFLINE="client_offline";e.WELCOME_TIMEOUT="welcome_timeout";e.WELCOME_EXPECTED="welcome_expected";e.WELCOME_INCONSISTENT="welcome_inconsitent";e.CORRUPTED_PACKET="corrupted_packet";e.CORRUPTED_OFFSET="corrupted_offset";e.CONNECTION_ERROR="connection_error";e.CONNECTION_CLOSED="connection_closed";e.KEEPALIVE_TIMEOUT="keepalive_timeout";e.CHANNEL_FAILURE="channel_failure";e.REGISTER_TIMEOUT="register_timeout";e.SUBSCRIBE_TIMEOUT="subscribe_timeout";e.UNSUBSCRIBE_TIMEOUT="unsubscribe_timeout"}(t||(t={}));function isErrorClosingSession(e){return e===t.WELCOME_EXPECTED||e===t.WELCOME_INCONSISTENT||e===t.CORRUPTED_OFFSET||e===t.CORRUPTED_PACKET}!function(e){e.SUBSCRIBE="1";e.UNSUBSCRIBE="2";e.ACK="3";e.SUBSCRIBED="5";e.UNSUBSCRIBED="6";e.MESSAGE="7";e.POSITION="8"}(n||(n={}));!function(e){e.OPEN="0";e.CLOSE="1";e.PING="2";e.PONG="3";e.MESSAGE="4";e.PRESENCE="5"}(i||(i={}));!function(e){e.REGISTER="1";e.REGISTERED="2"}(r||(r={}));!function(e){e[e.OFFLINE=0]="OFFLINE";e[e.POOR=1]="POOR";e[e.OK=2]="OK";e[e.GOOD=3]="GOOD";e[e.EXCELLENT=4]="EXCELLENT"}(s||(s={}));var b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==__webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self?self:{},g={exports:{}};!function(e,t){!function(t,n){e.exports=n(t)}("undefined"!=typeof self?self:"undefined"!=typeof window?window:b,function(t){var n,i,r=(t=t||{}).Base64,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=function(e){for(var t={},n=0,i=e.length;n<i;n++)t[e.charAt(n)]=n;return t}(s),a=String.fromCharCode,cb_utob=function(e){if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?a(192|t>>>6)+a(128|63&t):a(224|t>>>12&15)+a(128|t>>>6&63)+a(128|63&t)}var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return a(240|t>>>18&7)+a(128|t>>>12&63)+a(128|t>>>6&63)+a(128|63&t)},c=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=function(e){return e.replace(c,cb_utob)},cb_encode=function(e){var t=[0,2,1][e.length%3],n=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0);return[s.charAt(n>>>18),s.charAt(n>>>12&63),t>=2?"=":s.charAt(n>>>6&63),t>=1?"=":s.charAt(63&n)].join("")},l=t.btoa&&"function"==typeof t.btoa?function(e){return t.btoa(e)}:function(e){if(e.match(/[^\x00-\xFF]/))throw RangeError("The string contains invalid characters.");return e.replace(/[\s\S]{1,3}/g,cb_encode)},_encode=function(e){return l(utob(String(e)))},mkUriSafe=function(e){return e.replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,"")},encode=function(e,t){return t?mkUriSafe(_encode(e)):_encode(e)};t.Uint8Array&&(n=function fromUint8Array(e,t){for(var n="",i=0,r=e.length;i<r;i+=3){var o=e[i],a=e[i+1],c=e[i+2],l=o<<16|a<<8|c;n+=s.charAt(l>>>18)+s.charAt(l>>>12&63)+(void 0!==a?s.charAt(l>>>6&63):"=")+(void 0!==c?s.charAt(63&l):"=")}return t?mkUriSafe(n):n});var u=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,cb_btou=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return a((t>>>10)+55296)+a((1023&t)+56320);case 3:return a((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return a((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},btou=function(e){return e.replace(u,cb_btou)},cb_decode=function(e){var t=e.length,n=(t>0?o[e.charAt(0)]<<18:0)|(t>1?o[e.charAt(1)]<<12:0)|(t>2?o[e.charAt(2)]<<6:0)|(t>3?o[e.charAt(3)]:0),i=[a(n>>>16),a(n>>>8&255),a(255&n)];return i.length-=[0,0,2,1][t%4],i.join("")},h=t.atob&&"function"==typeof t.atob?function(e){return t.atob(e)}:function(e){return e.replace(/\S{1,4}/g,cb_decode)},atob=function(e){return h(String(e).replace(/[^A-Za-z0-9\+\/]/g,""))},_fromURI=function(e){return String(e).replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,"")},decode=function(e){return function(e){return btou(h(e))}(_fromURI(e))};t.Uint8Array&&(i=function toUint8Array(e){return Uint8Array.from(atob(_fromURI(e)),function(e){return e.charCodeAt(0)})});t.Base64={VERSION:"2.6.4",atob:atob,btoa:l,fromBase64:decode,toBase64:encode,utob:utob,encode:encode,encodeURI:function(e){return encode(e,!0)},btou:btou,decode:decode,noConflict:function(){var e=t.Base64;return t.Base64=r,e},fromUint8Array:n,toUint8Array:i};if("function"==typeof Object.defineProperty){var noEnum=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}};t.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",noEnum(function(){return decode(this)}));Object.defineProperty(String.prototype,"toBase64",noEnum(function(e){return encode(this,e)}));Object.defineProperty(String.prototype,"toBase64URI",noEnum(function(){return encode(this,!0)}))}}return t.Meteor&&(Base64=t.Base64),e.exports&&(e.exports.Base64=t.Base64),{Base64:t.Base64}})}(g);function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var m={};!function(e){var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function _has(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!==_typeof(n))throw TypeError(n+"must be non-object");for(var i in n)_has(n,i)&&(e[i]=n[i])}}return e};e.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function arraySet(e,t,n,i,r){if(t.subarray&&e.subarray)return void e.set(t.subarray(n,n+i),r);for(var s=0;s<i;s++)e[r+s]=t[n+s]},flattenChunks:function flattenChunks(e){var t,n,i,r,s,o;i=0;for(t=0,n=e.length;t<n;t++)i+=e[t].length;o=new Uint8Array(i);r=0;for(t=0,n=e.length;t<n;t++){s=e[t];o.set(s,r);r+=s.length}return o}},i={arraySet:function arraySet(e,t,n,i,r){for(var s=0;s<i;s++)e[r+s]=t[n+s]},flattenChunks:function flattenChunks(e){return[].concat.apply([],e)}};e.setTyped=function(t){if(t){e.Buf8=Uint8Array;e.Buf16=Uint16Array;e.Buf32=Int32Array;e.assign(e,n)}else{e.Buf8=Array;e.Buf16=Array;e.Buf32=Array;e.assign(e,i)}};e.setTyped(t)}(m);var w={},k={},E={},S=0,C=1;function zero$1(e){for(var t=e.length;--t>=0;)e[t]=0}var P=1,O=29,A=256,R=286,T=30,j=19,x=573,I=15,D=16,U=256,M=16,N=17,B=18,z=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],F=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],L=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],H=Array(576);zero$1(H);var Q=Array(2*T);zero$1(Q);var W=Array(512);zero$1(W);var Z=Array(256);zero$1(Z);var K=Array(O);zero$1(K);var V=Array(T);zero$1(V);function StaticTreeDesc(e,t,n,i,r){this.static_tree=e;this.extra_bits=t;this.extra_base=n;this.elems=i;this.max_length=r;this.has_stree=e&&e.length}function TreeDesc(e,t){this.dyn_tree=e;this.max_code=0;this.stat_desc=t}function d_code(e){return e<256?W[e]:W[256+(e>>>7)]}function put_short(e,t){e.pending_buf[e.pending++]=255&t;e.pending_buf[e.pending++]=t>>>8&255}function send_bits(e,t,n){if(e.bi_valid>D-n){e.bi_buf|=t<<e.bi_valid&65535;put_short(e,e.bi_buf);e.bi_buf=t>>D-e.bi_valid;e.bi_valid+=n-D}else{e.bi_buf|=t<<e.bi_valid&65535;e.bi_valid+=n}}function send_code(e,t,n){send_bits(e,n[2*t],n[2*t+1])}function bi_reverse(e,t){var n=0;do{n|=1&e;e>>>=1;n<<=1}while(--t>0);return n>>>1}function bi_flush(e){if(16===e.bi_valid){put_short(e,e.bi_buf);e.bi_buf=0;e.bi_valid=0}else if(e.bi_valid>=8){e.pending_buf[e.pending++]=255&e.bi_buf;e.bi_buf>>=8;e.bi_valid-=8}}function gen_bitlen(e,t){var n,i,r,s,o,a,c=t.dyn_tree,l=t.max_code,u=t.stat_desc.static_tree,h=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,_=t.stat_desc.max_length,p=0;for(s=0;s<=I;s++)e.bl_count[s]=0;c[2*e.heap[e.heap_max]+1]=0;for(n=e.heap_max+1;n<x;n++){s=c[2*c[2*(i=e.heap[n])+1]+1]+1;if(s>_){s=_;p++}c[2*i+1]=s;if(!(i>l)){e.bl_count[s]++;o=0;i>=d&&(o=f[i-d]);a=c[2*i];e.opt_len+=a*(s+o);h&&(e.static_len+=a*(u[2*i+1]+o))}}if(0!==p){do{s=_-1;for(;0===e.bl_count[s];)s--;e.bl_count[s]--;e.bl_count[s+1]+=2;e.bl_count[_]--;p-=2}while(p>0);for(s=_;0!==s;s--){i=e.bl_count[s];for(;0!==i;){r=e.heap[--n];if(!(r>l)){if(c[2*r+1]!==s){e.opt_len+=(s-c[2*r+1])*c[2*r];c[2*r+1]=s}i--}}}}}function gen_codes(e,t,n){var i,r,s=Array(I+1),o=0;for(i=1;i<=I;i++)s[i]=o=o+n[i-1]<<1;for(r=0;r<=t;r++){var a=e[2*r+1];0!==a&&(e[2*r]=bi_reverse(s[a]++,a))}}function tr_static_init(){var e,t,n,i,r,s=Array(I+1);n=0;for(i=0;i<O-1;i++){K[i]=n;for(e=0;e<1<<z[i];e++)Z[n++]=i}Z[n-1]=i;r=0;for(i=0;i<16;i++){V[i]=r;for(e=0;e<1<<F[i];e++)W[r++]=i}r>>=7;for(;i<T;i++){V[i]=r<<7;for(e=0;e<1<<F[i]-7;e++)W[256+r++]=i}for(t=0;t<=I;t++)s[t]=0;e=0;for(;e<=143;){H[2*e+1]=8;e++;s[8]++}for(;e<=255;){H[2*e+1]=9;e++;s[9]++}for(;e<=279;){H[2*e+1]=7;e++;s[7]++}for(;e<=287;){H[2*e+1]=8;e++;s[8]++}gen_codes(H,R+1,s);for(e=0;e<T;e++){Q[2*e+1]=5;Q[2*e]=bi_reverse(e,5)}o=new StaticTreeDesc(H,z,A+1,R,I);a=new StaticTreeDesc(Q,F,0,T,I);c=new StaticTreeDesc([],L,0,j,7)}function init_block(e){var t;for(t=0;t<R;t++)e.dyn_ltree[2*t]=0;for(t=0;t<T;t++)e.dyn_dtree[2*t]=0;for(t=0;t<j;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*U]=1;e.opt_len=e.static_len=0;e.last_lit=e.matches=0}function bi_windup(e){e.bi_valid>8?put_short(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf);e.bi_buf=0;e.bi_valid=0}function copy_block(e,t,n,i){bi_windup(e);if(i){put_short(e,n);put_short(e,~n)}m.arraySet(e.pending_buf,e.window,t,n,e.pending);e.pending+=n}function smaller(e,t,n,i){var r=2*t,s=2*n;return e[r]<e[s]||e[r]===e[s]&&i[t]<=i[n]}function pqdownheap(e,t,n){for(var i=e.heap[n],r=n<<1;r<=e.heap_len;){r<e.heap_len&&smaller(t,e.heap[r+1],e.heap[r],e.depth)&&r++;if(smaller(t,i,e.heap[r],e.depth))break;e.heap[n]=e.heap[r];n=r;r<<=1}e.heap[n]=i}function compress_block(e,t,n){var i,r,s,o,a=0;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*a]<<8|e.pending_buf[e.d_buf+2*a+1];r=e.pending_buf[e.l_buf+a];a++;if(0===i)send_code(e,r,t);else{send_code(e,(s=Z[r])+A+1,t);0!==(o=z[s])&&send_bits(e,r-=K[s],o);i--;send_code(e,s=d_code(i),n);0!==(o=F[s])&&send_bits(e,i-=V[s],o)}}while(a<e.last_lit);send_code(e,U,t)}function build_tree(e,t){var n,i,r,s=t.dyn_tree,o=t.stat_desc.static_tree,a=t.stat_desc.has_stree,c=t.stat_desc.elems,l=-1;e.heap_len=0;e.heap_max=x;for(n=0;n<c;n++)if(0!==s[2*n]){e.heap[++e.heap_len]=l=n;e.depth[n]=0}else s[2*n+1]=0;for(;e.heap_len<2;){s[2*(r=e.heap[++e.heap_len]=l<2?++l:0)]=1;e.depth[r]=0;e.opt_len--;a&&(e.static_len-=o[2*r+1])}t.max_code=l;for(n=e.heap_len>>1;n>=1;n--)pqdownheap(e,s,n);r=c;do{n=e.heap[1];e.heap[1]=e.heap[e.heap_len--];pqdownheap(e,s,1);i=e.heap[1];e.heap[--e.heap_max]=n;e.heap[--e.heap_max]=i;s[2*r]=s[2*n]+s[2*i];e.depth[r]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1;s[2*n+1]=s[2*i+1]=r;e.heap[1]=r++;pqdownheap(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1];gen_bitlen(e,t);gen_codes(s,l,e.bl_count)}function scan_tree(e,t,n){var i,r,s=-1,o=t[1],a=0,c=7,l=4;if(0===o){c=138;l=3}t[(n+1)*2+1]=65535;for(i=0;i<=n;i++){r=o;o=t[(i+1)*2+1];if(!(++a<c)||r!==o){if(a<l)e.bl_tree[2*r]+=a;else if(0!==r){r!==s&&e.bl_tree[2*r]++;e.bl_tree[2*M]++}else a<=10?e.bl_tree[2*N]++:e.bl_tree[2*B]++;a=0;s=r;if(0===o){c=138;l=3}else if(r===o){c=6;l=3}else{c=7;l=4}}}}function send_tree(e,t,n){var i,r,s=-1,o=t[1],a=0,c=7,l=4;if(0===o){c=138;l=3}for(i=0;i<=n;i++){r=o;o=t[(i+1)*2+1];if(!(++a<c)||r!==o){if(a<l)do send_code(e,r,e.bl_tree);while(0!=--a);else if(0!==r){if(r!==s){send_code(e,r,e.bl_tree);a--}send_code(e,M,e.bl_tree);send_bits(e,a-3,2)}else if(a<=10){send_code(e,N,e.bl_tree);send_bits(e,a-3,3)}else{send_code(e,B,e.bl_tree);send_bits(e,a-11,7)}a=0;s=r;if(0===o){c=138;l=3}else if(r===o){c=6;l=3}else{c=7;l=4}}}}function build_bl_tree(e){var t;scan_tree(e,e.dyn_ltree,e.l_desc.max_code);scan_tree(e,e.dyn_dtree,e.d_desc.max_code);build_tree(e,e.bl_desc);for(t=j-1;t>=3&&0===e.bl_tree[2*q[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function send_all_trees(e,t,n,i){var r;send_bits(e,t-257,5);send_bits(e,n-1,5);send_bits(e,i-4,4);for(r=0;r<i;r++)send_bits(e,e.bl_tree[2*q[r]+1],3);send_tree(e,e.dyn_ltree,t-1);send_tree(e,e.dyn_dtree,n-1)}function detect_data_type(e){var t,n=0xf3ffc07f;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return S;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return C;for(t=32;t<A;t++)if(0!==e.dyn_ltree[2*t])return C;return S}var G=!1;function _tr_stored_block(e,t,n,i){send_bits(e,0+ +!!i,3);copy_block(e,t,n,!0)}function _tr_align(e){send_bits(e,P<<1,3);send_code(e,U,H);bi_flush(e)}function _tr_flush_block(e,t,n,i){var r,s,o=0;if(e.level>0){2===e.strm.data_type&&(e.strm.data_type=detect_data_type(e));build_tree(e,e.l_desc);build_tree(e,e.d_desc);o=build_bl_tree(e);r=e.opt_len+3+7>>>3;(s=e.static_len+3+7>>>3)<=r&&(r=s)}else r=s=n+5;if(n+4<=r&&-1!==t)_tr_stored_block(e,t,n,i);else if(4===e.strategy||s===r){send_bits(e,(P<<1)+ +!!i,3);compress_block(e,H,Q)}else{send_bits(e,4+ +!!i,3);send_all_trees(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1);compress_block(e,e.dyn_ltree,e.dyn_dtree)}init_block(e);i&&bi_windup(e)}function _tr_tally(e,t,n){e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255;e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t;e.pending_buf[e.l_buf+e.last_lit]=255&n;e.last_lit++;if(0===t)e.dyn_ltree[2*n]++;else{e.matches++;t--;e.dyn_ltree[(Z[n]+A+1)*2]++;e.dyn_dtree[2*d_code(t)]++}return e.last_lit===e.lit_bufsize-1}E._tr_init=function _tr_init(e){if(!G){tr_static_init();G=!0}e.l_desc=new TreeDesc(e.dyn_ltree,o);e.d_desc=new TreeDesc(e.dyn_dtree,a);e.bl_desc=new TreeDesc(e.bl_tree,c);e.bi_buf=0;e.bi_valid=0;init_block(e)};E._tr_stored_block=_tr_stored_block;E._tr_flush_block=_tr_flush_block;E._tr_tally=_tr_tally;E._tr_align=_tr_align;var adler32_1=function(e,t,n,i){for(var r=65535&e,s=e>>>16&65535,o=0;0!==n;){o=n>2e3?2e3:n;n-=o;do s=s+(r=r+t[i++]|0)|0;while(--o);r%=65521;s%=65521}return r|s<<16},$=function makeTable(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?0xedb88320^e>>>1:e>>>1;t[n]=e}return t}(),crc32_1=function(e,t,n,i){var r=$,s=i+n;e^=-1;for(var o=i;o<s;o++)e=e>>>8^r[(e^t[o])&255];return -1^e},J={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},X=m,Y=E,ee=adler32_1,et=crc32_1,en=0,ei=4,er=5,es=0,eo=1,ea=-2,ec=-5,el=2,eu=8,eh=286,ef=573,ed=3,e_=258,ep=262,ev=42,ey=69,eb=73,eg=91,em=103,ew=113,ek=666,eE=1,eS=2,eC=3,eP=4;function err(e,t){return e.msg=J[t],t}function rank(e){return(e<<1)-9*(e>4)}function zero(e){for(var t=e.length;--t>=0;)e[t]=0}function flush_pending(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out);if(0!==n){X.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out);e.next_out+=n;t.pending_out+=n;e.total_out+=n;e.avail_out-=n;t.pending-=n;0===t.pending&&(t.pending_out=0)}}function flush_block_only(e,t){Y._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t);e.block_start=e.strstart;flush_pending(e.strm)}function put_byte(e,t){e.pending_buf[e.pending++]=t}function putShortMSB(e,t){e.pending_buf[e.pending++]=t>>>8&255;e.pending_buf[e.pending++]=255&t}function read_buf(e,t,n,i){var r=e.avail_in;return(r>i&&(r=i),0===r)?0:(e.avail_in-=r,X.arraySet(t,e.input,e.next_in,r,n),1===e.state.wrap?e.adler=ee(e.adler,t,r,n):2===e.state.wrap&&(e.adler=et(e.adler,t,r,n)),e.next_in+=r,e.total_in+=r,r)}function longest_match(e,t){var n,i,r=e.max_chain_length,s=e.strstart,o=e.prev_length,a=e.nice_match,c=e.strstart>e.w_size-ep?e.strstart-(e.w_size-ep):0,l=e.window,u=e.w_mask,h=e.prev,f=e.strstart+e_,d=l[s+o-1],_=l[s+o];e.prev_length>=e.good_match&&(r>>=2);a>e.lookahead&&(a=e.lookahead);do{n=t;if(l[n+o]!==_||l[n+o-1]!==d||l[n]!==l[s]||l[++n]!==l[s+1])continue;s+=2;n++;do;while(l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&s<f);i=e_-(f-s);s=f-e_;if(i>o){e.match_start=t;o=i;if(i>=a)break;d=l[s+o-1];_=l[s+o]}}while((t=h[t&u])>c&&0!=--r);return o<=e.lookahead?o:e.lookahead}function fill_window(e){var t,n,i,r,s,o=e.w_size;do{r=e.window_size-e.lookahead-e.strstart;if(e.strstart>=o+(o-ep)){X.arraySet(e.window,e.window,o,o,0);e.match_start-=o;e.strstart-=o;e.block_start-=o;t=n=e.hash_size;do{i=e.head[--t];e.head[t]=i>=o?i-o:0}while(--n);t=n=o;do{i=e.prev[--t];e.prev[t]=i>=o?i-o:0}while(--n);r+=o}if(0===e.strm.avail_in)break;n=read_buf(e.strm,e.window,e.strstart+e.lookahead,r);e.lookahead+=n;if(e.lookahead+e.insert>=ed){s=e.strstart-e.insert;e.ins_h=e.window[s];e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;for(;e.insert;){e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+ed-1])&e.hash_mask;e.prev[s&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=s;s++;e.insert--;if(e.lookahead+e.insert<ed)break}}}while(e.lookahead<ep&&0!==e.strm.avail_in)}function deflate_fast(e,t){for(var n,i;;){if(e.lookahead<ep){fill_window(e);if(e.lookahead<ep&&t===en)return eE;if(0===e.lookahead)break}n=0;if(e.lookahead>=ed){e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ed-1])&e.hash_mask;n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=e.strstart}0!==n&&e.strstart-n<=e.w_size-ep&&(e.match_length=longest_match(e,n));if(e.match_length>=ed){i=Y._tr_tally(e,e.strstart-e.match_start,e.match_length-ed);e.lookahead-=e.match_length;if(e.match_length<=e.max_lazy_match&&e.lookahead>=ed){e.match_length--;do{e.strstart++;e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ed-1])&e.hash_mask;n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else{e.strstart+=e.match_length;e.match_length=0;e.ins_h=e.window[e.strstart];e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask}}else{i=Y._tr_tally(e,0,e.window[e.strstart]);e.lookahead--;e.strstart++}if(i){flush_block_only(e,!1);if(0===e.strm.avail_out)return eE}}e.insert=e.strstart<ed-1?e.strstart:ed-1;if(t===ei)return(flush_block_only(e,!0),0===e.strm.avail_out)?eC:eP;if(e.last_lit){flush_block_only(e,!1);if(0===e.strm.avail_out)return eE}return eS}function deflate_slow(e,t){for(var n,i,r;;){if(e.lookahead<ep){fill_window(e);if(e.lookahead<ep&&t===en)return eE;if(0===e.lookahead)break}n=0;if(e.lookahead>=ed){e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ed-1])&e.hash_mask;n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=e.strstart}e.prev_length=e.match_length;e.prev_match=e.match_start;e.match_length=ed-1;if(0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-ep){e.match_length=longest_match(e,n);e.match_length<=5&&(1===e.strategy||e.match_length===ed&&e.strstart-e.match_start>4096)&&(e.match_length=ed-1)}if(e.prev_length>=ed&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-ed;i=Y._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-ed);e.lookahead-=e.prev_length-1;e.prev_length-=2;do if(++e.strstart<=r){e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ed-1])&e.hash_mask;n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=e.strstart}while(0!=--e.prev_length);e.match_available=0;e.match_length=ed-1;e.strstart++;if(i){flush_block_only(e,!1);if(0===e.strm.avail_out)return eE}}else if(e.match_available){(i=Y._tr_tally(e,0,e.window[e.strstart-1]))&&flush_block_only(e,!1);e.strstart++;e.lookahead--;if(0===e.strm.avail_out)return eE}else{e.match_available=1;e.strstart++;e.lookahead--}}if(e.match_available){i=Y._tr_tally(e,0,e.window[e.strstart-1]);e.match_available=0}e.insert=e.strstart<ed-1?e.strstart:ed-1;if(t===ei)return(flush_block_only(e,!0),0===e.strm.avail_out)?eC:eP;if(e.last_lit){flush_block_only(e,!1);if(0===e.strm.avail_out)return eE}return eS}function deflate_rle(e,t){for(var n,i,r,s,o=e.window;;){if(e.lookahead<=e_){fill_window(e);if(e.lookahead<=e_&&t===en)return eE;if(0===e.lookahead)break}e.match_length=0;if(e.lookahead>=ed&&e.strstart>0){i=o[r=e.strstart-1];if(i===o[++r]&&i===o[++r]&&i===o[++r]){s=e.strstart+e_;do;while(i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&r<s);e.match_length=e_-(s-r);e.match_length>e.lookahead&&(e.match_length=e.lookahead)}}if(e.match_length>=ed){n=Y._tr_tally(e,1,e.match_length-ed);e.lookahead-=e.match_length;e.strstart+=e.match_length;e.match_length=0}else{n=Y._tr_tally(e,0,e.window[e.strstart]);e.lookahead--;e.strstart++}if(n){flush_block_only(e,!1);if(0===e.strm.avail_out)return eE}}e.insert=0;if(t===ei)return(flush_block_only(e,!0),0===e.strm.avail_out)?eC:eP;if(e.last_lit){flush_block_only(e,!1);if(0===e.strm.avail_out)return eE}return eS}function deflate_huff(e,t){for(var n;;){if(0===e.lookahead){fill_window(e);if(0===e.lookahead){if(t===en)return eE;break}}e.match_length=0;n=Y._tr_tally(e,0,e.window[e.strstart]);e.lookahead--;e.strstart++;if(n){flush_block_only(e,!1);if(0===e.strm.avail_out)return eE}}e.insert=0;if(t===ei)return(flush_block_only(e,!0),0===e.strm.avail_out)?eC:eP;if(e.last_lit){flush_block_only(e,!1);if(0===e.strm.avail_out)return eE}return eS}function Config(e,t,n,i,r){this.good_length=e;this.max_lazy=t;this.nice_length=n;this.max_chain=i;this.func=r}l=[new Config(0,0,0,0,function deflate_stored(e,t){var n=65535;65535>e.pending_buf_size-5&&(n=e.pending_buf_size-5);for(;;){if(e.lookahead<=1){fill_window(e);if(0===e.lookahead&&t===en)return eE;if(0===e.lookahead)break}e.strstart+=e.lookahead;e.lookahead=0;var i=e.block_start+n;if(0===e.strstart||e.strstart>=i){e.lookahead=e.strstart-i;e.strstart=i;flush_block_only(e,!1);if(0===e.strm.avail_out)return eE}if(e.strstart-e.block_start>=e.w_size-ep){flush_block_only(e,!1);if(0===e.strm.avail_out)return eE}}e.insert=0;if(t===ei)return(flush_block_only(e,!0),0===e.strm.avail_out)?eC:eP;if(e.strstart>e.block_start){flush_block_only(e,!1);e.strm.avail_out}return eE}),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)];function lm_init(e){e.window_size=2*e.w_size;zero(e.head);e.max_lazy_match=l[e.level].max_lazy;e.good_match=l[e.level].good_length;e.nice_match=l[e.level].nice_length;e.max_chain_length=l[e.level].max_chain;e.strstart=0;e.block_start=0;e.lookahead=0;e.insert=0;e.match_length=e.prev_length=ed-1;e.match_available=0;e.ins_h=0}function DeflateState(){this.strm=null;this.status=0;this.pending_buf=null;this.pending_buf_size=0;this.pending_out=0;this.pending=0;this.wrap=0;this.gzhead=null;this.gzindex=0;this.method=eu;this.last_flush=-1;this.w_size=0;this.w_bits=0;this.w_mask=0;this.window=null;this.window_size=0;this.prev=null;this.head=null;this.ins_h=0;this.hash_size=0;this.hash_bits=0;this.hash_mask=0;this.hash_shift=0;this.block_start=0;this.match_length=0;this.prev_match=0;this.match_available=0;this.strstart=0;this.match_start=0;this.lookahead=0;this.prev_length=0;this.max_chain_length=0;this.max_lazy_match=0;this.level=0;this.strategy=0;this.good_match=0;this.nice_match=0;this.dyn_ltree=new X.Buf16(2*ef);this.dyn_dtree=new X.Buf16(122);this.bl_tree=new X.Buf16(78);zero(this.dyn_ltree);zero(this.dyn_dtree);zero(this.bl_tree);this.l_desc=null;this.d_desc=null;this.bl_desc=null;this.bl_count=new X.Buf16(16);this.heap=new X.Buf16(2*eh+1);zero(this.heap);this.heap_len=0;this.heap_max=0;this.depth=new X.Buf16(2*eh+1);zero(this.depth);this.l_buf=0;this.lit_bufsize=0;this.last_lit=0;this.d_buf=0;this.opt_len=0;this.static_len=0;this.matches=0;this.insert=0;this.bi_buf=0;this.bi_valid=0}function deflateResetKeep(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?ev:ew,e.adler=+(2!==t.wrap),t.last_flush=en,Y._tr_init(t),es):err(e,ea)}function deflateReset(e){var t=deflateResetKeep(e);return t===es&&lm_init(e.state),t}function deflateSetHeader(e,t){return e&&e.state&&2===e.state.wrap?(e.state.gzhead=t,es):ea}function deflateInit2(e,t,n,i,r,s){if(!e)return ea;var o=1;-1===t&&(t=6);if(i<0){o=0;i=-i}else if(i>15){o=2;i-=16}if(r<1||r>9||n!==eu||i<8||i>15||t<0||t>9||s<0||s>4)return err(e,ea);8===i&&(i=9);var a=new DeflateState;return e.state=a,a.strm=e,a.wrap=o,a.gzhead=null,a.w_bits=i,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=r+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+ed-1)/ed),a.window=new X.Buf8(2*a.w_size),a.head=new X.Buf16(a.hash_size),a.prev=new X.Buf16(a.w_size),a.lit_bufsize=1<<r+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new X.Buf8(a.pending_buf_size),a.d_buf=+a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=t,a.strategy=s,a.method=n,deflateReset(e)}function deflate$2(e,t){if(!e||!e.state||t>er||t<0)return e?err(e,ea):ea;i=e.state;if(!e.output||!e.input&&0!==e.avail_in||i.status===ek&&t!==ei)return err(e,0===e.avail_out?ec:ea);i.strm=e;n=i.last_flush;i.last_flush=t;if(i.status===ev)if(2===i.wrap){e.adler=0;put_byte(i,31);put_byte(i,139);put_byte(i,8);if(i.gzhead){put_byte(i,+!!i.gzhead.text+2*!!i.gzhead.hcrc+4*!!i.gzhead.extra+8*!!i.gzhead.name+16*!!i.gzhead.comment);put_byte(i,255&i.gzhead.time);put_byte(i,i.gzhead.time>>8&255);put_byte(i,i.gzhead.time>>16&255);put_byte(i,i.gzhead.time>>24&255);put_byte(i,9===i.level?2:4*(i.strategy>=el||i.level<2));put_byte(i,255&i.gzhead.os);if(i.gzhead.extra&&i.gzhead.extra.length){put_byte(i,255&i.gzhead.extra.length);put_byte(i,i.gzhead.extra.length>>8&255)}i.gzhead.hcrc&&(e.adler=et(e.adler,i.pending_buf,i.pending,0));i.gzindex=0;i.status=ey}else{put_byte(i,0);put_byte(i,0);put_byte(i,0);put_byte(i,0);put_byte(i,0);put_byte(i,9===i.level?2:4*(i.strategy>=el||i.level<2));put_byte(i,3);i.status=ew}}else{var n,i,r,s,o=eu+(i.w_bits-8<<4)<<8;o|=(i.strategy>=el||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6;0!==i.strstart&&(o|=32);o+=31-o%31;i.status=ew;putShortMSB(i,o);if(0!==i.strstart){putShortMSB(i,e.adler>>>16);putShortMSB(i,65535&e.adler)}e.adler=1}if(i.status===ey)if(i.gzhead.extra){r=i.pending;for(;i.gzindex<(65535&i.gzhead.extra.length);){if(i.pending===i.pending_buf_size){i.gzhead.hcrc&&i.pending>r&&(e.adler=et(e.adler,i.pending_buf,i.pending-r,r));flush_pending(e);r=i.pending;if(i.pending===i.pending_buf_size)break}put_byte(i,255&i.gzhead.extra[i.gzindex]);i.gzindex++}i.gzhead.hcrc&&i.pending>r&&(e.adler=et(e.adler,i.pending_buf,i.pending-r,r));if(i.gzindex===i.gzhead.extra.length){i.gzindex=0;i.status=eb}}else i.status=eb;if(i.status===eb)if(i.gzhead.name){r=i.pending;do{if(i.pending===i.pending_buf_size){i.gzhead.hcrc&&i.pending>r&&(e.adler=et(e.adler,i.pending_buf,i.pending-r,r));flush_pending(e);r=i.pending;if(i.pending===i.pending_buf_size){s=1;break}}s=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0;put_byte(i,s)}while(0!==s);i.gzhead.hcrc&&i.pending>r&&(e.adler=et(e.adler,i.pending_buf,i.pending-r,r));if(0===s){i.gzindex=0;i.status=eg}}else i.status=eg;if(i.status===eg)if(i.gzhead.comment){r=i.pending;do{if(i.pending===i.pending_buf_size){i.gzhead.hcrc&&i.pending>r&&(e.adler=et(e.adler,i.pending_buf,i.pending-r,r));flush_pending(e);r=i.pending;if(i.pending===i.pending_buf_size){s=1;break}}s=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0;put_byte(i,s)}while(0!==s);i.gzhead.hcrc&&i.pending>r&&(e.adler=et(e.adler,i.pending_buf,i.pending-r,r));0===s&&(i.status=em)}else i.status=em;if(i.status===em)if(i.gzhead.hcrc){i.pending+2>i.pending_buf_size&&flush_pending(e);if(i.pending+2<=i.pending_buf_size){put_byte(i,255&e.adler);put_byte(i,e.adler>>8&255);e.adler=0;i.status=ew}}else i.status=ew;if(0!==i.pending){flush_pending(e);if(0===e.avail_out)return i.last_flush=-1,es}else if(0===e.avail_in&&rank(t)<=rank(n)&&t!==ei)return err(e,ec);if(i.status===ek&&0!==e.avail_in)return err(e,ec);if(0!==e.avail_in||0!==i.lookahead||t!==en&&i.status!==ek){var a=i.strategy===el?deflate_huff(i,t):3===i.strategy?deflate_rle(i,t):l[i.level].func(i,t);(a===eC||a===eP)&&(i.status=ek);if(a===eE||a===eC)return 0===e.avail_out&&(i.last_flush=-1),es;if(a===eS){if(1===t)Y._tr_align(i);else if(t!==er){Y._tr_stored_block(i,0,0,!1);if(3===t){zero(i.head);if(0===i.lookahead){i.strstart=0;i.block_start=0;i.insert=0}}}flush_pending(e);if(0===e.avail_out)return i.last_flush=-1,es}}if(t!==ei)return es;if(i.wrap<=0)return eo;if(2===i.wrap){put_byte(i,255&e.adler);put_byte(i,e.adler>>8&255);put_byte(i,e.adler>>16&255);put_byte(i,e.adler>>24&255);put_byte(i,255&e.total_in);put_byte(i,e.total_in>>8&255);put_byte(i,e.total_in>>16&255);put_byte(i,e.total_in>>24&255)}else{putShortMSB(i,e.adler>>>16);putShortMSB(i,65535&e.adler)}return flush_pending(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?es:eo}function deflateEnd(e){var t;return e&&e.state?(t=e.state.status)!==ev&&t!==ey&&t!==eb&&t!==eg&&t!==em&&t!==ew&&t!==ek?err(e,ea):(e.state=null,t===ew?err(e,-3):es):ea}function deflateSetDictionary(e,t){var n,i,r,s,o,a,c,l,u=t.length;if(!e||!e.state)return ea;s=(n=e.state).wrap;if(2===s||1===s&&n.status!==ev||n.lookahead)return ea;1===s&&(e.adler=ee(e.adler,t,u,0));n.wrap=0;if(u>=n.w_size){if(0===s){zero(n.head);n.strstart=0;n.block_start=0;n.insert=0}l=new X.Buf8(n.w_size);X.arraySet(l,t,u-n.w_size,n.w_size,0);t=l;u=n.w_size}o=e.avail_in;a=e.next_in;c=e.input;e.avail_in=u;e.next_in=0;e.input=t;fill_window(n);for(;n.lookahead>=ed;){i=n.strstart;r=n.lookahead-(ed-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+ed-1])&n.hash_mask;n.prev[i&n.w_mask]=n.head[n.ins_h];n.head[n.ins_h]=i;i++}while(--r);n.strstart=i;n.lookahead=ed-1;fill_window(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=ed-1,n.match_available=0,e.next_in=a,e.input=c,e.avail_in=o,n.wrap=s,es}k.deflateInit=function deflateInit(e,t){return deflateInit2(e,t,eu,15,8,0)};k.deflateInit2=deflateInit2;k.deflateReset=deflateReset;k.deflateResetKeep=deflateResetKeep;k.deflateSetHeader=deflateSetHeader;k.deflate=deflate$2;k.deflateEnd=deflateEnd;k.deflateSetDictionary=deflateSetDictionary;k.deflateInfo="pako deflate (from Nodeca project)";var eO={},eA=m,eR=!0,eT=!0;try{String.fromCharCode.apply(null,[0])}catch(e){eR=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){eT=!1}for(var ej=new eA.Buf8(256),ex=0;ex<256;ex++)ej[ex]=ex>=252?6:ex>=248?5:ex>=240?4:ex>=224?3:ex>=192?2:1;ej[254]=ej[254]=1;eO.string2buf=function(e){var t,n,i,r,s,o=e.length,a=0;for(r=0;r<o;r++){n=e.charCodeAt(r);if((64512&n)==55296&&r+1<o){i=e.charCodeAt(r+1);if((64512&i)==56320){n=65536+(n-55296<<10)+(i-56320);r++}}a+=n<128?1:n<2048?2:n<65536?3:4}t=new eA.Buf8(a);for(s=0,r=0;s<a;r++){n=e.charCodeAt(r);if((64512&n)==55296&&r+1<o){i=e.charCodeAt(r+1);if((64512&i)==56320){n=65536+(n-55296<<10)+(i-56320);r++}}if(n<128)t[s++]=n;else if(n<2048){t[s++]=192|n>>>6;t[s++]=128|63&n}else if(n<65536){t[s++]=224|n>>>12;t[s++]=128|n>>>6&63;t[s++]=128|63&n}else{t[s++]=240|n>>>18;t[s++]=128|n>>>12&63;t[s++]=128|n>>>6&63;t[s++]=128|63&n}}return t};function buf2binstring(e,t){if(t<65534&&(e.subarray&&eT||!e.subarray&&eR))return String.fromCharCode.apply(null,eA.shrinkBuf(e,t));for(var n="",i=0;i<t;i++)n+=String.fromCharCode(e[i]);return n}eO.buf2binstring=function(e){return buf2binstring(e,e.length)};eO.binstring2buf=function(e){for(var t=new eA.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t};eO.buf2string=function(e,t){var n,i,r,s,o=t||e.length,a=Array(2*o);for(i=0,n=0;n<o;){r=e[n++];if(r<128){a[i++]=r;continue}s=ej[r];if(s>4){a[i++]=65533;n+=s-1;continue}r&=2===s?31:3===s?15:7;for(;s>1&&n<o;){r=r<<6|63&e[n++];s--}if(s>1){a[i++]=65533;continue}if(r<65536)a[i++]=r;else{r-=65536;a[i++]=55296|r>>10&1023;a[i++]=56320|1023&r}}return buf2binstring(a,i)};eO.utf8border=function(e,t){var n;(t=t||e.length)>e.length&&(t=e.length);n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||0===n?t:n+ej[e[n]]>t?n:t};var zstream=function(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0},eI=k,eD=m,eU=eO,eM=J,eN=Object.prototype.toString,eB=4,ez=0,eF=1,eL=2;function Deflate(e){if(!(this instanceof Deflate))return new Deflate(e);this.options=eD.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t,n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new zstream;this.strm.avail_out=0;var i=eI.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(i!==ez)throw Error(eM[i]);n.header&&eI.deflateSetHeader(this.strm,n.header);if(n.dictionary){t="string"==typeof n.dictionary?eU.string2buf(n.dictionary):"[object ArrayBuffer]"===eN.call(n.dictionary)?new Uint8Array(n.dictionary):n.dictionary;i=eI.deflateSetDictionary(this.strm,t);if(i!==ez)throw Error(eM[i]);this._dict_set=!0}}Deflate.prototype.push=function(e,t){var n,i,r=this.strm,s=this.options.chunkSize;if(this.ended)return!1;i=t===~~t?t:!0===t?eB:0;"string"==typeof e?r.input=eU.string2buf(e):"[object ArrayBuffer]"===eN.call(e)?r.input=new Uint8Array(e):r.input=e;r.next_in=0;r.avail_in=r.input.length;do{if(0===r.avail_out){r.output=new eD.Buf8(s);r.next_out=0;r.avail_out=s}n=eI.deflate(r,i);if(n!==eF&&n!==ez){this.onEnd(n);this.ended=!0;return!1}(0===r.avail_out||0===r.avail_in&&(i===eB||i===eL))&&("string"===this.options.to?this.onData(eU.buf2binstring(eD.shrinkBuf(r.output,r.next_out))):this.onData(eD.shrinkBuf(r.output,r.next_out)))}while((r.avail_in>0||0===r.avail_out)&&n!==eF);if(i===eB)return n=eI.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===ez;if(i===eL){this.onEnd(ez);r.avail_out=0}return!0};Deflate.prototype.onData=function(e){this.chunks.push(e)};Deflate.prototype.onEnd=function(e){e===ez&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=eD.flattenChunks(this.chunks));this.chunks=[];this.err=e;this.msg=this.strm.msg};function deflate$1(e,t){var n=new Deflate(t);n.push(e,!0);if(n.err)throw n.msg||eM[n.err];return n.result}function deflateRaw(e,t){return(t=t||{}).raw=!0,deflate$1(e,t)}function gzip(e,t){return(t=t||{}).gzip=!0,deflate$1(e,t)}w.Deflate=Deflate;w.deflate=deflate$1;w.deflateRaw=deflateRaw;w.gzip=gzip;var eq={},eH={},eQ=30,eW=m,eZ=15,eK=852,eV=592,eG=0,e$=1,eJ=2,eX=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],eY=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],e0=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],e1=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],e2=m,e5=adler32_1,e6=crc32_1,inflate_fast=function(e,t){var n,i,r,s,o,a,c,l,u,h,f,d,_,p,v,y,b,g,m,w,k,E,S,C,P;n=e.state;i=e.next_in;C=e.input;r=i+(e.avail_in-5);s=e.next_out;P=e.output;o=s-(t-e.avail_out);a=s+(e.avail_out-257);c=n.dmax;l=n.wsize;u=n.whave;h=n.wnext;f=n.window;d=n.hold;_=n.bits;p=n.lencode;v=n.distcode;y=(1<<n.lenbits)-1;b=(1<<n.distbits)-1;e:do{if(_<15){d+=C[i++]<<_;_+=8;d+=C[i++]<<_;_+=8}g=p[d&y];for(;;){d>>>=m=g>>>24;_-=m;m=g>>>16&255;if(0===m)P[s++]=65535&g;else if(16&m){w=65535&g;m&=15;if(m){if(_<m){d+=C[i++]<<_;_+=8}w+=d&(1<<m)-1;d>>>=m;_-=m}if(_<15){d+=C[i++]<<_;_+=8;d+=C[i++]<<_;_+=8}g=v[d&b];for(;;){d>>>=m=g>>>24;_-=m;m=g>>>16&255;if(16&m){k=65535&g;m&=15;if(_<m){d+=C[i++]<<_;_+=8;if(_<m){d+=C[i++]<<_;_+=8}}k+=d&(1<<m)-1;if(k>c){e.msg="invalid distance too far back";n.mode=eQ;break e}d>>>=m;_-=m;m=s-o;if(k>m){m=k-m;if(m>u&&n.sane){e.msg="invalid distance too far back";n.mode=eQ;break e}E=0;S=f;if(0===h){E+=l-m;if(m<w){w-=m;do P[s++]=f[E++];while(--m);E=s-k;S=P}}else if(h<m){E+=l+h-m;m-=h;if(m<w){w-=m;do P[s++]=f[E++];while(--m);E=0;if(h<w){w-=m=h;do P[s++]=f[E++];while(--m);E=s-k;S=P}}}else{E+=h-m;if(m<w){w-=m;do P[s++]=f[E++];while(--m);E=s-k;S=P}}for(;w>2;){P[s++]=S[E++];P[s++]=S[E++];P[s++]=S[E++];w-=3}if(w){P[s++]=S[E++];w>1&&(P[s++]=S[E++])}}else{E=s-k;do{P[s++]=P[E++];P[s++]=P[E++];P[s++]=P[E++];w-=3}while(w>2);if(w){P[s++]=P[E++];w>1&&(P[s++]=P[E++])}}}else if((64&m)==0){g=v[(65535&g)+(d&(1<<m)-1)];continue}else{e.msg="invalid distance code";n.mode=eQ;break e}break}}else if((64&m)==0){g=p[(65535&g)+(d&(1<<m)-1)];continue}else if(32&m){n.mode=12;break e}else{e.msg="invalid literal/length code";n.mode=eQ;break e}break}}while(i<r&&s<a);i-=w=_>>3;_-=w<<3;d&=(1<<_)-1;e.next_in=i;e.next_out=s;e.avail_in=i<r?5+(r-i):5-(i-r);e.avail_out=s<a?257+(a-s):257-(s-a);n.hold=d;n.bits=_},inflate_table=function(e,t,n,i,r,s,o,a){var c,l,u,h,f,d,_,p,v,y=a.bits,b=0,g=0,m=0,w=0,k=0,E=0,S=0,C=0,P=0,O=0,A=null,R=0,T=new eW.Buf16(eZ+1),j=new eW.Buf16(eZ+1),x=null,I=0;for(b=0;b<=eZ;b++)T[b]=0;for(g=0;g<i;g++)T[t[n+g]]++;k=y;for(w=eZ;w>=1&&0===T[w];w--);k>w&&(k=w);if(0===w)return r[s++]=0x1400000,r[s++]=0x1400000,a.bits=1,0;for(m=1;m<w&&0===T[m];m++);k<m&&(k=m);C=1;for(b=1;b<=eZ;b++){C<<=1;C-=T[b];if(C<0)return -1}if(C>0&&(e===eG||1!==w))return -1;j[1]=0;for(b=1;b<eZ;b++)j[b+1]=j[b]+T[b];for(g=0;g<i;g++)0!==t[n+g]&&(o[j[t[n+g]]++]=g);if(e===eG){A=x=o;d=19}else if(e===e$){A=eX;R-=257;x=eY;I-=257;d=256}else{A=e0;x=e1;d=-1}O=0;g=0;b=m;f=s;E=k;S=0;u=-1;h=(P=1<<k)-1;if(e===e$&&P>eK||e===eJ&&P>eV)return 1;for(;;){_=b-S;if(o[g]<d){p=0;v=o[g]}else if(o[g]>d){p=x[I+o[g]];v=A[R+o[g]]}else{p=96;v=0}c=1<<b-S;m=l=1<<E;do r[f+(O>>S)+(l-=c)]=_<<24|p<<16|v;while(0!==l);c=1<<b-1;for(;O&c;)c>>=1;if(0!==c){O&=c-1;O+=c}else O=0;g++;if(0==--T[b]){if(b===w)break;b=t[n+o[g]]}if(b>k&&(O&h)!==u){0===S&&(S=k);f+=m;C=1<<(E=b-S);for(;E+S<w;){C-=T[E+S];if(C<=0)break;E++;C<<=1}P+=1<<E;if(e===e$&&P>eK||e===eJ&&P>eV)return 1;r[u=O&h]=k<<24|E<<16|f-s}}return 0!==O&&(r[f+O]=b-S<<24|4194304),a.bits=k,0},e3=1,e8=2,e4=4,e7=6,e9=0,te=-2,tt=-3,tn=-4,ti=8,tr=1,ts=2,to=3,ta=4,tc=5,tl=6,tu=7,th=8,tf=9,td=10,t_=11,tp=12,tv=13,ty=14,tb=15,tg=16,tm=17,tw=18,tk=19,tE=20,tS=21,tC=22,tP=23,tO=24,tA=25,tR=26,tT=27,tj=28,tx=29,tI=30,tD=31;function zswap32(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function InflateState(){this.mode=0;this.last=!1;this.wrap=0;this.havedict=!1;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new e2.Buf16(320);this.work=new e2.Buf16(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0}function inflateResetKeep(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=tr,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new e2.Buf32(852),t.distcode=t.distdyn=new e2.Buf32(592),t.sane=1,t.back=-1,e9):te}function inflateReset(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,inflateResetKeep(e)):te}function inflateReset2(e,t){var n,i;if(!e||!e.state)return te;i=e.state;if(t<0){n=0;t=-t}else{n=(t>>4)+1;t<48&&(t&=15)}return t&&(t<8||t>15)?te:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,inflateReset(e))}function inflateInit2(e,t){var n,i;return e?(e.state=i=new InflateState,i.window=null,(n=inflateReset2(e,t))!==e9&&(e.state=null),n):te}function inflateInit(e){return inflateInit2(e,15)}var tU=!0;function fixedtables(e){if(tU){var t;u=new e2.Buf32(512);h=new e2.Buf32(32);t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;inflate_table(e3,e.lens,0,288,u,0,e.work,{bits:9});t=0;for(;t<32;)e.lens[t++]=5;inflate_table(e8,e.lens,0,32,h,0,e.work,{bits:5});tU=!1}e.lencode=u;e.lenbits=9;e.distcode=h;e.distbits=5}function updatewindow(e,t,n,i){var r,s=e.state;if(null===s.window){s.wsize=1<<s.wbits;s.wnext=0;s.whave=0;s.window=new e2.Buf8(s.wsize)}if(i>=s.wsize){e2.arraySet(s.window,t,n-s.wsize,s.wsize,0);s.wnext=0;s.whave=s.wsize}else{(r=s.wsize-s.wnext)>i&&(r=i);e2.arraySet(s.window,t,n-i,r,s.wnext);i-=r;if(i){e2.arraySet(s.window,t,n-i,i,0);s.wnext=i;s.whave=s.wsize}else{s.wnext+=r;s.wnext===s.wsize&&(s.wnext=0);s.whave<s.wsize&&(s.whave+=r)}}return 0}function inflate$2(e,t){var n,i,r,s,o,a,c,l,u,h,f,d,_,p,v,y,b,g,m,w,k,E,S,C,P=0,O=new e2.Buf8(4),A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return te;(n=e.state).mode===tp&&(n.mode=tv);o=e.next_out;r=e.output;c=e.avail_out;s=e.next_in;i=e.input;a=e.avail_in;l=n.hold;u=n.bits;h=a;f=c;E=e9;t:for(;;)switch(n.mode){case tr:if(0===n.wrap){n.mode=tv;break}for(;u<16;){if(0===a)break t;a--;l+=i[s++]<<u;u+=8}if(2&n.wrap&&35615===l){n.check=0;O[0]=255&l;O[1]=l>>>8&255;n.check=e6(n.check,O,2,0);l=0;u=0;n.mode=ts;break}n.flags=0;n.head&&(n.head.done=!1);if(!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check";n.mode=tI;break}if((15&l)!==ti){e.msg="unknown compression method";n.mode=tI;break}l>>>=4;u-=4;k=(15&l)+8;if(0===n.wbits)n.wbits=k;else if(k>n.wbits){e.msg="invalid window size";n.mode=tI;break}n.dmax=1<<k;e.adler=n.check=1;n.mode=512&l?td:tp;l=0;u=0;break;case ts:for(;u<16;){if(0===a)break t;a--;l+=i[s++]<<u;u+=8}n.flags=l;if((255&n.flags)!==ti){e.msg="unknown compression method";n.mode=tI;break}if(57344&n.flags){e.msg="unknown header flags set";n.mode=tI;break}n.head&&(n.head.text=l>>8&1);if(512&n.flags){O[0]=255&l;O[1]=l>>>8&255;n.check=e6(n.check,O,2,0)}l=0;u=0;n.mode=to;case to:for(;u<32;){if(0===a)break t;a--;l+=i[s++]<<u;u+=8}n.head&&(n.head.time=l);if(512&n.flags){O[0]=255&l;O[1]=l>>>8&255;O[2]=l>>>16&255;O[3]=l>>>24&255;n.check=e6(n.check,O,4,0)}l=0;u=0;n.mode=ta;case ta:for(;u<16;){if(0===a)break t;a--;l+=i[s++]<<u;u+=8}if(n.head){n.head.xflags=255&l;n.head.os=l>>8}if(512&n.flags){O[0]=255&l;O[1]=l>>>8&255;n.check=e6(n.check,O,2,0)}l=0;u=0;n.mode=tc;case tc:if(1024&n.flags){for(;u<16;){if(0===a)break t;a--;l+=i[s++]<<u;u+=8}n.length=l;n.head&&(n.head.extra_len=l);if(512&n.flags){O[0]=255&l;O[1]=l>>>8&255;n.check=e6(n.check,O,2,0)}l=0;u=0}else n.head&&(n.head.extra=null);n.mode=tl;case tl:if(1024&n.flags){(d=n.length)>a&&(d=a);if(d){if(n.head){k=n.head.extra_len-n.length;n.head.extra||(n.head.extra=Array(n.head.extra_len));e2.arraySet(n.head.extra,i,s,d,k)}512&n.flags&&(n.check=e6(n.check,i,d,s));a-=d;s+=d;n.length-=d}if(n.length)break t}n.length=0;n.mode=tu;case tu:if(2048&n.flags){if(0===a)break t;d=0;do{k=i[s+d++];n.head&&k&&n.length<65536&&(n.head.name+=String.fromCharCode(k))}while(k&&d<a);512&n.flags&&(n.check=e6(n.check,i,d,s));a-=d;s+=d;if(k)break t}else n.head&&(n.head.name=null);n.length=0;n.mode=th;case th:if(4096&n.flags){if(0===a)break t;d=0;do{k=i[s+d++];n.head&&k&&n.length<65536&&(n.head.comment+=String.fromCharCode(k))}while(k&&d<a);512&n.flags&&(n.check=e6(n.check,i,d,s));a-=d;s+=d;if(k)break t}else n.head&&(n.head.comment=null);n.mode=tf;case tf:if(512&n.flags){for(;u<16;){if(0===a)break t;a--;l+=i[s++]<<u;u+=8}if(l!==(65535&n.check)){e.msg="header crc mismatch";n.mode=tI;break}l=0;u=0}if(n.head){n.head.hcrc=n.flags>>9&1;n.head.done=!0}e.adler=n.check=0;n.mode=tp;break;case td:for(;u<32;){if(0===a)break t;a--;l+=i[s++]<<u;u+=8}e.adler=n.check=zswap32(l);l=0;u=0;n.mode=t_;case t_:if(0===n.havedict){e.next_out=o;e.avail_out=c;e.next_in=s;e.avail_in=a;n.hold=l;n.bits=u;return 2}e.adler=n.check=1;n.mode=tp;case tp:if(5===t||t===e7)break t;case tv:if(n.last){l>>>=7&u;u-=7&u;n.mode=tT;break}for(;u<3;){if(0===a)break t;a--;l+=i[s++]<<u;u+=8}n.last=1&l;l>>>=1;u-=1;switch(3&l){case 0:n.mode=ty;break;case 1:fixedtables(n);n.mode=tE;if(t===e7){l>>>=2;u-=2;break t}break;case 2:n.mode=tm;break;case 3:e.msg="invalid block type";n.mode=tI}l>>>=2;u-=2;break;case ty:l>>>=7&u;u-=7&u;for(;u<32;){if(0===a)break t;a--;l+=i[s++]<<u;u+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths";n.mode=tI;break}n.length=65535&l;l=0;u=0;n.mode=tb;if(t===e7)break t;case tb:n.mode=tg;case tg:d=n.length;if(d){d>a&&(d=a);d>c&&(d=c);if(0===d)break t;e2.arraySet(r,i,s,d,o);a-=d;s+=d;c-=d;o+=d;n.length-=d;break}n.mode=tp;break;case tm:for(;u<14;){if(0===a)break t;a--;l+=i[s++]<<u;u+=8}n.nlen=(31&l)+257;u-=5;n.ndist=(31&(l>>>=5))+1;u-=5;n.ncode=(15&(l>>>=5))+4;l>>>=4;u-=4;if(n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols";n.mode=tI;break}n.have=0;n.mode=tw;case tw:for(;n.have<n.ncode;){for(;u<3;){if(0===a)break t;a--;l+=i[s++]<<u;u+=8}n.lens[A[n.have++]]=7&l;l>>>=3;u-=3}for(;n.have<19;)n.lens[A[n.have++]]=0;n.lencode=n.lendyn;n.lenbits=7;S={bits:n.lenbits};E=inflate_table(0,n.lens,0,19,n.lencode,0,n.work,S);n.lenbits=S.bits;if(E){e.msg="invalid code lengths set";n.mode=tI;break}n.have=0;n.mode=tk;case tk:for(;n.have<n.nlen+n.ndist;){for(;;){v=(P=n.lencode[l&(1<<n.lenbits)-1])>>>24;y=P>>>16&255;b=65535&P;if(v<=u)break;if(0===a)break t;a--;l+=i[s++]<<u;u+=8}if(b<16){l>>>=v;u-=v;n.lens[n.have++]=b}else{if(16===b){C=v+2;for(;u<C;){if(0===a)break t;a--;l+=i[s++]<<u;u+=8}l>>>=v;u-=v;if(0===n.have){e.msg="invalid bit length repeat";n.mode=tI;break}k=n.lens[n.have-1];d=3+(3&l);l>>>=2;u-=2}else if(17===b){C=v+3;for(;u<C;){if(0===a)break t;a--;l+=i[s++]<<u;u+=8}l>>>=v;u-=v;k=0;d=3+(7&l);l>>>=3;u-=3}else{C=v+7;for(;u<C;){if(0===a)break t;a--;l+=i[s++]<<u;u+=8}l>>>=v;u-=v;k=0;d=11+(127&l);l>>>=7;u-=7}if(n.have+d>n.nlen+n.ndist){e.msg="invalid bit length repeat";n.mode=tI;break}for(;d--;)n.lens[n.have++]=k}}if(n.mode===tI)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block";n.mode=tI;break}n.lenbits=9;S={bits:n.lenbits};E=inflate_table(e3,n.lens,0,n.nlen,n.lencode,0,n.work,S);n.lenbits=S.bits;if(E){e.msg="invalid literal/lengths set";n.mode=tI;break}n.distbits=6;n.distcode=n.distdyn;S={bits:n.distbits};E=inflate_table(e8,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,S);n.distbits=S.bits;if(E){e.msg="invalid distances set";n.mode=tI;break}n.mode=tE;if(t===e7)break t;case tE:n.mode=tS;case tS:if(a>=6&&c>=258){e.next_out=o;e.avail_out=c;e.next_in=s;e.avail_in=a;n.hold=l;n.bits=u;inflate_fast(e,f);o=e.next_out;r=e.output;c=e.avail_out;s=e.next_in;i=e.input;a=e.avail_in;l=n.hold;u=n.bits;n.mode===tp&&(n.back=-1);break}n.back=0;for(;;){v=(P=n.lencode[l&(1<<n.lenbits)-1])>>>24;y=P>>>16&255;b=65535&P;if(v<=u)break;if(0===a)break t;a--;l+=i[s++]<<u;u+=8}if(y&&(240&y)==0){g=v;m=y;w=b;for(;;){v=(P=n.lencode[w+((l&(1<<g+m)-1)>>g)])>>>24;y=P>>>16&255;b=65535&P;if(g+v<=u)break;if(0===a)break t;a--;l+=i[s++]<<u;u+=8}l>>>=g;u-=g;n.back+=g}l>>>=v;u-=v;n.back+=v;n.length=b;if(0===y){n.mode=tR;break}if(32&y){n.back=-1;n.mode=tp;break}if(64&y){e.msg="invalid literal/length code";n.mode=tI;break}n.extra=15&y;n.mode=tC;case tC:if(n.extra){C=n.extra;for(;u<C;){if(0===a)break t;a--;l+=i[s++]<<u;u+=8}n.length+=l&(1<<n.extra)-1;l>>>=n.extra;u-=n.extra;n.back+=n.extra}n.was=n.length;n.mode=tP;case tP:for(;;){v=(P=n.distcode[l&(1<<n.distbits)-1])>>>24;y=P>>>16&255;b=65535&P;if(v<=u)break;if(0===a)break t;a--;l+=i[s++]<<u;u+=8}if((240&y)==0){g=v;m=y;w=b;for(;;){v=(P=n.distcode[w+((l&(1<<g+m)-1)>>g)])>>>24;y=P>>>16&255;b=65535&P;if(g+v<=u)break;if(0===a)break t;a--;l+=i[s++]<<u;u+=8}l>>>=g;u-=g;n.back+=g}l>>>=v;u-=v;n.back+=v;if(64&y){e.msg="invalid distance code";n.mode=tI;break}n.offset=b;n.extra=15&y;n.mode=tO;case tO:if(n.extra){C=n.extra;for(;u<C;){if(0===a)break t;a--;l+=i[s++]<<u;u+=8}n.offset+=l&(1<<n.extra)-1;l>>>=n.extra;u-=n.extra;n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back";n.mode=tI;break}n.mode=tA;case tA:if(0===c)break t;d=f-c;if(n.offset>d){d=n.offset-d;if(d>n.whave&&n.sane){e.msg="invalid distance too far back";n.mode=tI;break}if(d>n.wnext){d-=n.wnext;_=n.wsize-d}else _=n.wnext-d;d>n.length&&(d=n.length);p=n.window}else{p=r;_=o-n.offset;d=n.length}d>c&&(d=c);c-=d;n.length-=d;do r[o++]=p[_++];while(--d);0===n.length&&(n.mode=tS);break;case tR:if(0===c)break t;r[o++]=n.length;c--;n.mode=tS;break;case tT:if(n.wrap){for(;u<32;){if(0===a)break t;a--;l|=i[s++]<<u;u+=8}f-=c;e.total_out+=f;n.total+=f;f&&(e.adler=n.check=n.flags?e6(n.check,r,f,o-f):e5(n.check,r,f,o-f));f=c;if((n.flags?l:zswap32(l))!==n.check){e.msg="incorrect data check";n.mode=tI;break}l=0;u=0}n.mode=tj;case tj:if(n.wrap&&n.flags){for(;u<32;){if(0===a)break t;a--;l+=i[s++]<<u;u+=8}if(l!==(0|n.total)){e.msg="incorrect length check";n.mode=tI;break}l=0;u=0}n.mode=tx;case tx:E=1;break t;case tI:E=tt;break t;case tD:return tn;default:return te}return e.next_out=o,e.avail_out=c,e.next_in=s,e.avail_in=a,n.hold=l,n.bits=u,(n.wsize||f!==e.avail_out&&n.mode<tI&&(n.mode<tT||t!==e4))&&updatewindow(e,e.output,e.next_out,f-e.avail_out),h-=e.avail_in,f-=e.avail_out,e.total_in+=h,e.total_out+=f,n.total+=f,n.wrap&&f&&(e.adler=n.check=n.flags?e6(n.check,r,f,e.next_out-f):e5(n.check,r,f,e.next_out-f)),e.data_type=n.bits+64*!!n.last+128*(n.mode===tp)+256*(n.mode===tE||n.mode===tb),(0===h&&0===f||t===e4)&&E===e9&&(E=-5),E}function inflateEnd(e){if(!e||!e.state)return te;var t=e.state;return t.window&&(t.window=null),e.state=null,e9}function inflateGetHeader(e,t){var n;return e&&e.state?(2&(n=e.state).wrap)==0?te:(n.head=t,t.done=!1,e9):te}function inflateSetDictionary(e,t){var n,i,r,s=t.length;if(!e||!e.state)return te;n=e.state;if(0!==n.wrap&&n.mode!==t_)return te;if(n.mode===t_){i=e5(i=1,t,s,0);if(i!==n.check)return tt}return(r=updatewindow(e,t,s,s),r)?(n.mode=tD,tn):(n.havedict=1,e9)}eH.inflateReset=inflateReset;eH.inflateReset2=inflateReset2;eH.inflateResetKeep=inflateResetKeep;eH.inflateInit=inflateInit;eH.inflateInit2=inflateInit2;eH.inflate=inflate$2;eH.inflateEnd=inflateEnd;eH.inflateGetHeader=inflateGetHeader;eH.inflateSetDictionary=inflateSetDictionary;eH.inflateInfo="pako inflate (from Nodeca project)";var tM={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},gzheader=function(){this.text=0;this.time=0;this.xflags=0;this.os=0;this.extra=null;this.extra_len=0;this.name="";this.comment="";this.hcrc=0;this.done=!1},tN=eH,tB=m,tz=eO,tF=tM,tL=J,tq=Object.prototype.toString;function Inflate(e){if(!(this instanceof Inflate))return new Inflate(e);this.options=tB.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;if(t.raw&&t.windowBits>=0&&t.windowBits<16){t.windowBits=-t.windowBits;0===t.windowBits&&(t.windowBits=-15)}t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32);t.windowBits>15&&t.windowBits<48&&(15&t.windowBits)==0&&(t.windowBits|=15);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new zstream;this.strm.avail_out=0;var n=tN.inflateInit2(this.strm,t.windowBits);if(n!==tF.Z_OK)throw Error(tL[n]);this.header=new gzheader;tN.inflateGetHeader(this.strm,this.header);if(t.dictionary){"string"==typeof t.dictionary?t.dictionary=tz.string2buf(t.dictionary):"[object ArrayBuffer]"===tq.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary));if(t.raw){n=tN.inflateSetDictionary(this.strm,t.dictionary);if(n!==tF.Z_OK)throw Error(tL[n])}}}Inflate.prototype.push=function(e,t){var n,i,r,s,o,a=this.strm,c=this.options.chunkSize,l=this.options.dictionary,u=!1;if(this.ended)return!1;i=t===~~t?t:!0===t?tF.Z_FINISH:tF.Z_NO_FLUSH;"string"==typeof e?a.input=tz.binstring2buf(e):"[object ArrayBuffer]"===tq.call(e)?a.input=new Uint8Array(e):a.input=e;a.next_in=0;a.avail_in=a.input.length;do{if(0===a.avail_out){a.output=new tB.Buf8(c);a.next_out=0;a.avail_out=c}(n=tN.inflate(a,tF.Z_NO_FLUSH))===tF.Z_NEED_DICT&&l&&(n=tN.inflateSetDictionary(this.strm,l));if(n===tF.Z_BUF_ERROR&&!0===u){n=tF.Z_OK;u=!1}if(n!==tF.Z_STREAM_END&&n!==tF.Z_OK){this.onEnd(n);this.ended=!0;return!1}if(a.next_out&&(0===a.avail_out||n===tF.Z_STREAM_END||0===a.avail_in&&(i===tF.Z_FINISH||i===tF.Z_SYNC_FLUSH)))if("string"===this.options.to){r=tz.utf8border(a.output,a.next_out);s=a.next_out-r;o=tz.buf2string(a.output,r);a.next_out=s;a.avail_out=c-s;s&&tB.arraySet(a.output,a.output,r,s,0);this.onData(o)}else this.onData(tB.shrinkBuf(a.output,a.next_out));0===a.avail_in&&0===a.avail_out&&(u=!0)}while((a.avail_in>0||0===a.avail_out)&&n!==tF.Z_STREAM_END);n===tF.Z_STREAM_END&&(i=tF.Z_FINISH);if(i===tF.Z_FINISH)return n=tN.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===tF.Z_OK;if(i===tF.Z_SYNC_FLUSH){this.onEnd(tF.Z_OK);a.avail_out=0}return!0};Inflate.prototype.onData=function(e){this.chunks.push(e)};Inflate.prototype.onEnd=function(e){e===tF.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=tB.flattenChunks(this.chunks));this.chunks=[];this.err=e;this.msg=this.strm.msg};function inflate$1(e,t){var n=new Inflate(t);n.push(e,!0);if(n.err)throw n.msg||tL[n.err];return n.result}function inflateRaw(e,t){return(t=t||{}).raw=!0,inflate$1(e,t)}eq.Inflate=Inflate;eq.inflate=inflate$1;eq.inflateRaw=inflateRaw;eq.ungzip=inflate$1;var tH=m.assign,tQ={};tH(tQ,w,eq,tM);function decode(e){var t=new Uint8Array(g.exports.Base64.atob(e).split("").map(function(e){return e.charCodeAt(0)}));return JSON.parse(tQ.inflate(t,{to:"string"}))}function ownKeys$1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread$1(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$1(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$1(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function newSet(){return new Set}function newSetFromArray(e){return new Set(e)}function newArrayFromSet(e){var t=[];return e&&e.forEach(function(e){return t.push(e)}),t}function newMap(){return new Map}function objectKeys(e){return Object.keys(e)}function objectValues(e){return Object.values(e)}function objectEntries(e){return Object.entries(e)}function overrideOptions(e,t){var n=_objectSpread$1({},e);return t&&objectKeys(e).forEach(function(e){void 0!==t[e]&&(n[e]=t[e])}),n}function stringStartsWith(e,t,n){return String.prototype.startsWith.call(e,t,n)}function stringEndsWith(e,t,n){return String.prototype.endsWith.call(e,t,n)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return!0}catch(e){return!1}}function _construct(e,t,n){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function _construct(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&_setPrototypeOf(r,n.prototype),r}).apply(null,arguments)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _nonIterableSpread(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}var tW=function(){function Logger(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];_classCallCheck(this,Logger);_defineProperty(this,"enabled",void 0);_defineProperty(this,"prefix",void 0);this.enabled=e;for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.prefix=n}return _createClass(Logger,[{key:"isEnabled",value:function isEnabled(){return this.enabled}},{key:"setEnabled",value:function setEnabled(e){this.enabled=e}},{key:"log",value:function log(){if(this.enabled)try{for(var e,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).log.apply(e,["[PubSub]"].concat(_toConsumableArray(this.prefix),n))}catch(e){}}},{key:"error",value:function error(){if(this.enabled)try{for(var e,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).error.apply(e,["[PubSub]"].concat(_toConsumableArray(this.prefix),n))}catch(e){}}},{key:"create",value:function create(e){return _construct(Logger,[this.enabled].concat(_toConsumableArray(this.prefix),[e]))}}])}(),tZ=function(){function PingPong(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tW;_classCallCheck(this,PingPong);_defineProperty(this,"connection",void 0);_defineProperty(this,"logger",void 0);_defineProperty(this,"timeout",void 0);_defineProperty(this,"timeoutMs",void 0);this.connection=e;this.logger=t}return _createClass(PingPong,[{key:"start",value:function start(e,t){this.timeoutMs=e;this.log("Started: interval:".concat(t,", timeout:").concat(e));this.reset()}},{key:"handle",value:function handle(e){this.reset();if(stringStartsWith(e,i.PING)){this.log("Ping Pong");this.connection.send(i.PONG)}}},{key:"stop",value:function stop(){this.clearTimeout()}},{key:"reset",value:function reset(){var e=this;this.clearTimeout();this.timeout=setTimeout(function(){e.log("Timeout");e.connection.onTimeout()},this.timeoutMs)}},{key:"clearTimeout",value:function(e){function clearTimeout(){return e.apply(this,arguments)}return clearTimeout.toString=function(){return e.toString()},clearTimeout}(function(){if(this.timeout){clearTimeout(this.timeout);this.timeout=void 0}})},{key:"log",value:function log(){for(var e,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=this.logger).log.apply(e,["[Ping/Pong]"].concat(n))}}])}(),tK=function(){function Connection(e,t,n,i,r){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new tW;_classCallCheck(this,Connection);_defineProperty(this,"subscriptions",void 0);_defineProperty(this,"socket",void 0);_defineProperty(this,"defaultOptions",void 0);_defineProperty(this,"logger",void 0);_defineProperty(this,"closedByError",void 0);_defineProperty(this,"alive",void 0);_defineProperty(this,"welcomeTimeout",void 0);_defineProperty(this,"welcomRequestTimeout",void 0);_defineProperty(this,"options",void 0);_defineProperty(this,"pingPong",void 0);_defineProperty(this,"welcomeReceived",void 0);_defineProperty(this,"sessionId",void 0);_defineProperty(this,"sessionOffset",void 0);_defineProperty(this,"sessionOptions",void 0);_defineProperty(this,"timeoutMs",void 0);_defineProperty(this,"intervalMs",void 0);this.subscriptions=e;this.socket=t;this.defaultOptions=n;this.logger=s;this.alive=!0;this.sessionId=i;this.sessionOffset=r;this.welcomeReceived=!1;this.options=n;this.setWelcomeTimeout();this.log("Created: options:",this.options);var o=this.logger.create("[Connection("+this.socket.id()+")]");this.pingPong=new tZ(this,o)}return _createClass(Connection,[{key:"getOptions",value:function getOptions(){return this.options}},{key:"getSessionId",value:function getSessionId(){return this.sessionId}},{key:"getSessionOffset",value:function getSessionOffset(){return this.sessionOffset}},{key:"getSessionOptions",value:function getSessionOptions(){return this.sessionOptions}},{key:"getTimeoutMs",value:function getTimeoutMs(){return this.timeoutMs}},{key:"getIntervalMs",value:function getIntervalMs(){return this.intervalMs}},{key:"send",value:function send(e){this.socket.send(e)}},{key:"onTimeout",value:function onTimeout(){this.log("Timeout");this.terminateByError(t.KEEPALIVE_TIMEOUT)}},{key:"onPacket",value:function onPacket(e){try{if(this.alive)if(stringStartsWith(e,i.OPEN)){var n=JSON.parse(e.substring(1));this.clearWelcomeTimeout();this.onConnectionOpen(n);return s.OK}else{if(!this.welcomeReceived)return void this.terminateByError(t.WELCOME_EXPECTED);this.pingPong.handle(e);if(stringStartsWith(e,i.PING)&&e.length>1){var o=JSON.parse(e.substring(1));return _slicedToArray(o,1)[0]}if(stringStartsWith(e,i.MESSAGE)){var a=e.slice(1,2),c=JSON.parse(e.substring(2));this.onSubscriptionMessage(a,c)}if(stringStartsWith(e,i.PRESENCE)){var l=e.slice(1,2);if(l===r.REGISTERED){var u=JSON.parse(e.substring(2)),h=_slicedToArray(u,3),f=h[0],d=h[1],_=h[2];this.setOffset(f)&&this.subscriptions.onRegistered(d,_)}}}}catch(e){this.terminateByError(t.CORRUPTED_PACKET)}}},{key:"onClose",value:function onClose(){if(this.alive){this.terminateByError(t.CONNECTION_CLOSED);this.log("Connection close")}}},{key:"onError",value:function onError(e){if(this.alive){this.terminateByError(e);this.log("Connection error")}}},{key:"subscribe",value:function subscribe(e,t){this.log("Subscribe: channel:".concat(e,", position:").concat(t));var r=i.MESSAGE+n.SUBSCRIBE;this.alive&&(t?this.send("".concat(r,'["').concat(e,'", "').concat(t,'"]')):this.send("".concat(r,'["').concat(e,'"]')))}},{key:"unsubscribe",value:function unsubscribe(e){this.log("Unsubscribe: channel:".concat(e));this.send("".concat(i.MESSAGE).concat(n.UNSUBSCRIBE,'["').concat(e,'"]'))}},{key:"register",value:function register(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("Register: capabilities:".concat(e,", activities:"),t);var n=i.PRESENCE+r.REGISTER;if(this.alive){var s=JSON.stringify(e),o=JSON.stringify(t);this.send("".concat(n,"[").concat(s,",").concat(o,"]"))}}},{key:"close",value:function close(e,t){this.terminate(!1,e,t)}},{key:"terminateByError",value:function terminateByError(e){this.terminate(this.welcomeReceived,isErrorClosingSession(e),e)}},{key:"terminate",value:function terminate(e,t,n){if(this.alive){this.log("Closing...");this.alive=!1;this.closedByError=n;this.pingPong.stop();this.clearWelcomeTimeout();e&&this.welcomeReceived&&this.subscriptions.onDetach();if(this.socket){t&&this.send("1");this.socket.close()}this.log("Closed")}}},{key:"onConnectionOpen",value:function onConnectionOpen(e){var n=_slicedToArray(e,4),i=n[0],r=n[1],s=n[2],o=n[3];if(this.welcomeReceived)if(this.sessionId!==i)return void this.terminateByError(t.WELCOME_INCONSISTENT);else{this.handshake(i,r,s,o);this.subscriptions.onUpdate(o)}else{this.welcomeReceived=!0;this.log("Connected");this.log("SessionId:",i);if(this.sessionId!==i){this.sessionId=i;this.sessionOffset=0}this.handshake(i,r,s,o);this.subscriptions.onAttach(this)}}},{key:"handshake",value:function handshake(e,t,n,i){this.updateSessionOptions(i);this.restartPingPong(t,n)&&this.send("0"+JSON.stringify([e,t,n]))}},{key:"onSubscriptionMessage",value:function onSubscriptionMessage(e,t){var i=t[0],r=t[1],s=String(t[2]);if(this.setOffset(i)){e===n.SUBSCRIBED&&this.subscriptions.onSubscribed(r,s);if(e===n.UNSUBSCRIBED){var o=Number(t[2]),a=t[3]?Number(t[3]):void 0;this.subscriptions.onUnsubscribed(r,o,a)}if(e===n.MESSAGE){var c=1!==t[4]?t[3]:decode(t[3]);this.subscriptions.onMessage(r,s,c)}e===n.POSITION&&this.subscriptions.onPosition(r,s)}}},{key:"setOffset",value:function setOffset(e){return void 0===this.sessionOffset||e-this.sessionOffset!=1?(this.terminateByError(t.CORRUPTED_OFFSET),!1):(this.sendAck(e),this.sessionOffset=e,!0)}},{key:"sendAck",value:function sendAck(e){this.log("Ack: offset:".concat(e));this.send("".concat(i.MESSAGE).concat(n.ACK,"[").concat(e,"]"))}},{key:"setWelcomeTimeout",value:function setWelcomeTimeout(){var e=this;this.options.welcomeRequestDelayMs<=0?this.send("".concat(i.OPEN)):this.welcomRequestTimeout=setTimeout(function(){e.welcomRequestTimeout=void 0;e.alive&&!e.welcomeReceived&&e.send("".concat(i.OPEN))},this.options.welcomeRequestDelayMs);this.welcomeTimeout=setTimeout(function(){if(e.alive&&!e.welcomeReceived){e.log("Welcome Timeout");e.terminateByError(t.WELCOME_TIMEOUT)}},this.options.welcomeMaxDelayMs)}},{key:"clearWelcomeTimeout",value:function clearWelcomeTimeout(){if(this.welcomRequestTimeout){clearTimeout(this.welcomRequestTimeout);this.welcomRequestTimeout=void 0}if(this.welcomeTimeout){clearTimeout(this.welcomeTimeout);this.welcomeTimeout=void 0}}},{key:"restartPingPong",value:function restartPingPong(e,t){var n=1e3*e,i=1e3*t;return(this.intervalMs!==n||this.timeoutMs!==i)&&(this.intervalMs=1e3*e,this.timeoutMs=1e3*t,this.log("Ping Interval",e,"Seconds"),this.log("Ping Timeout:",t,"Seconds"),this.pingPong.start(this.timeoutMs,this.intervalMs),!0)}},{key:"updateSessionOptions",value:function updateSessionOptions(e){this.sessionOptions=e;this.options=overrideOptions(this.defaultOptions,e)}},{key:"log",value:function log(){for(var e,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=this.logger).log.apply(e,["[Connection("+this.socket.id()+")]"].concat(n))}}])}(),tV=function(){function ConnectionFactory(e,t,n){_classCallCheck(this,ConnectionFactory);_defineProperty(this,"subscriptions",void 0);_defineProperty(this,"options",void 0);_defineProperty(this,"logger",void 0);this.subscriptions=e;this.options=t;this.logger=n}return _createClass(ConnectionFactory,[{key:"create",value:function create(e,t,n){return new tK(this.subscriptions,e,this.options,t,n,this.logger)}}])}(),tG=function(){function SafeClientListener(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new tW;_classCallCheck(this,SafeClientListener);_defineProperty(this,"listener",void 0);_defineProperty(this,"errorHandler",void 0);_defineProperty(this,"logger",void 0);this.listener=e;this.errorHandler=t;this.logger=n}return _createClass(SafeClientListener,[{key:"onConnect",value:function onConnect(e){var t=this;this.safe(function(){t.listener.onConnect&&t.listener.onConnect(e)},"Connected")}},{key:"onAttach",value:function onAttach(){var e=this;this.safe(function(){e.listener.onAttach&&e.listener.onAttach()},"Attached")}},{key:"onDetach",value:function onDetach(){var e=this;this.safe(function(){e.listener.onDetach&&e.listener.onDetach()},"Detached")}},{key:"onFailure",value:function onFailure(e){var t=this;this.safe(function(){t.listener.onFailure&&t.listener.onFailure(e)},"Failed",e)}},{key:"safe",value:function safe(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.log.apply(this,n);try{e()}catch(e){this.error(e);this.logError("Listener callback failure: ",e)}}},{key:"error",value:function error(e){try{this.errorHandler&&this.errorHandler.error(e)}catch(e){}}},{key:"log",value:function log(){for(var e,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=this.logger).log.apply(e,["[Listener]"].concat(n))}},{key:"logError",value:function logError(){for(var e,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=this.logger).error.apply(e,["[Listener]"].concat(n))}}])}(),t$=function(){function SocketFactory(e,t){_classCallCheck(this,SocketFactory);_defineProperty(this,"factory",void 0);_defineProperty(this,"logger",void 0);this.factory=e;this.logger=t||new tW}return _createClass(SocketFactory,[{key:"create",value:function create(e,t,n){var i=this,r=!0,s=this.factory(t);s.onopen=function(){if(r){i.log(e,"Open");n.onOpen(e)}};s.onmessage=function(t){if(r){i.log(e,"Received:",t.data);n.onMessage(e,t.data)}};s.onclose=function(t){if(r){r=!1;i.log(e,"Closed:",t);n.onClose(e,t.code)}};s.onerror=function(t){if(r){r=!1;i.log(e,"Failed:",t);n.onError(e)}};var o=this;return{id:function id(){return e},send:function send(t){if(r)try{o.log(e,"Send:",t);s.send(t)}catch(t){o.log(e,"Send error",t);r=!1;o.closeSocket(e,s);n.onClose(e)}},close:function close(){if(r){o.log(e,"Close");r=!1;o.closeSocket(e,s);n.onClose(e)}}}}},{key:"closeSocket",value:function closeSocket(e,t){try{t.close()}catch(t){this.log(e,"Close error (ignored)",t)}}},{key:"log",value:function log(e){for(var t,n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(t=this.logger).log.apply(t,["[Socket("+e+")]"].concat(i))}}])}();function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function createSubscriptionFailure(e,t,n){switch(e){case 401:return _objectSpread({code:e,message:"user not authenticated",channel:t},n);case 403:return _objectSpread({code:e,message:"channel access forbidden",channel:t},n);case 404:return _objectSpread({code:e,message:"channel not found",channel:t},n);case 430:return _objectSpread({code:e,message:"too many open channels",channel:t},n);default:return _objectSpread({code:e,message:"unknown problem",channel:t},n)}}var tJ=function(){function CategoriesAggregator(){_classCallCheck(this,CategoriesAggregator);_defineProperty(this,"capabilities",newSet());_defineProperty(this,"activities",newMap())}return _createClass(CategoriesAggregator,[{key:"add",value:function add(e){var t=this;if(e){e.capabilities&&e.capabilities.forEach(function(e){return t.capabilities.add(e)});e.activities&&objectEntries(e.activities).forEach(function(e){var n=_slicedToArray(e,2),i=n[0],r=n[1],s=t.getActivitySet(i);r&&r.forEach(function(e){return s.add(e)})})}}},{key:"get",value:function get(){return{capabilities:this.convertCapabilities(),activities:this.convertActivities()}}},{key:"convertCapabilities",value:function convertCapabilities(){if(0!==this.capabilities.size)return newArrayFromSet(this.capabilities)}},{key:"convertActivities",value:function convertActivities(){if(0!==this.activities.size){var e={};return this.activities.forEach(function(t,n){t&&(e[n]=newArrayFromSet(t))}),e}}},{key:"getActivitySet",value:function getActivitySet(e){var t=this.activities.get(e);if(void 0===t){t=newSet();this.activities.set(e,t)}return t}}])}(),tX=function(){function SafeSubscriber(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new tW;_classCallCheck(this,SafeSubscriber);_defineProperty(this,"subscriberId",void 0);_defineProperty(this,"subscriber",void 0);_defineProperty(this,"errorHandler",void 0);_defineProperty(this,"logger",void 0);this.subscriberId=e;this.subscriber=t;this.errorHandler=n;this.logger=i}return _createClass(SafeSubscriber,[{key:"onAttach",value:function onAttach(e){var t=this;this.safe(function(){t.subscriber.onAttach&&t.subscriber.onAttach(e)},"Attached: continuation:".concat(e))}},{key:"onDetach",value:function onDetach(){var e=this;this.safe(function(){e.subscriber.onDetach&&e.subscriber.onDetach()},"Detached")}},{key:"onMessage",value:function onMessage(e){var t=this;this.safe(function(){t.subscriber.onMessage&&t.subscriber.onMessage(e)},"Message: ",e);this.log("Message: ",e)}},{key:"onComplete",value:function onComplete(){var e=this;this.safe(function(){e.subscriber.onComplete&&e.subscriber.onComplete()},"Completed")}},{key:"onFailure",value:function onFailure(e){var t=this;this.safe(function(){t.subscriber.onFailure&&t.subscriber.onFailure(e)},"Failed",e)}},{key:"safe",value:function safe(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.log.apply(this,n);try{e()}catch(e){this.error(e);this.logError("Subscriber callback failure: ",e)}}},{key:"error",value:function error(e){try{this.errorHandler&&this.errorHandler.error(e)}catch(e){}}},{key:"log",value:function log(){for(var e,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=this.logger).log.apply(e,["[Subscriber(".concat(this.subscriberId,")]")].concat(n))}},{key:"logError",value:function logError(){for(var e,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=this.logger).error.apply(e,["[Subscriber(".concat(this.subscriberId,")]")].concat(n))}}])}(),tY=function(){function Subscription(e,t,n){_classCallCheck(this,Subscription);_defineProperty(this,"callbackErrorHandler",void 0);_defineProperty(this,"logger",void 0);_defineProperty(this,"attached",!1);_defineProperty(this,"position",void 0);_defineProperty(this,"subscribers",{});this.callbackErrorHandler=t;this.logger=n?n.create("[Subscription(".concat(e,")]")):new tW}return _createClass(Subscription,[{key:"addSubscriber",value:function addSubscriber(e,t,n){this.log("Added: subscriberId:".concat(e,", categories:"),n);var i=new tX(e,t,this.callbackErrorHandler,this.logger);this.subscribers[e]={subscriber:i,categories:n};this.attached&&i.onAttach(!1)}},{key:"updateSubscriber",value:function updateSubscriber(e,t){this.log("Updated: subscriberId:".concat(e,", categories:").concat(t));this.subscribers[e]&&(this.subscribers[e].categories=t)}},{key:"removeSubscriber",value:function removeSubscriber(e){this.log("Removed: subscriberId:".concat(e));delete this.subscribers[e]}},{key:"setPosition",value:function setPosition(e){this.position=e}},{key:"getPosition",value:function getPosition(){return this.position}},{key:"isEmpty",value:function isEmpty(){return 0===Object.keys(this.subscribers).length}},{key:"isAttached",value:function isAttached(){return this.attached}},{key:"getCategories",value:function getCategories(){var e=new tJ;return objectValues(this.subscribers).forEach(function(t){e.add(t.categories)}),e.get()}},{key:"onAttach",value:function onAttach(e){var t=!e||this.position===e;this.attached=!0;this.position=e||this.position;objectValues(this.subscribers).forEach(function(e){e.subscriber.onAttach(t)})}},{key:"onDetach",value:function onDetach(){this.attached=!1;objectValues(this.subscribers).forEach(function(e){e.subscriber.onDetach()})}},{key:"onComplete",value:function onComplete(){this.attached=!1;objectValues(this.subscribers).forEach(function(e){e.subscriber.onComplete()})}},{key:"onFailure",value:function onFailure(e){this.attached=!1;objectValues(this.subscribers).forEach(function(t){t.subscriber.onFailure(e)})}},{key:"onMessage",value:function onMessage(e,t){this.setPosition(e);objectValues(this.subscribers).forEach(function(e){e.subscriber.onMessage(t)})}},{key:"log",value:function log(){var e;(e=this.logger).log.apply(e,arguments)}}])}(),t0=function(){function Subscriptions(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;_classCallCheck(this,Subscriptions);_defineProperty(this,"listener",void 0);_defineProperty(this,"defaultOptions",void 0);_defineProperty(this,"capabilities",void 0);_defineProperty(this,"callbackErrorHandler",void 0);_defineProperty(this,"alive",!0);_defineProperty(this,"connection",void 0);_defineProperty(this,"sessionId",void 0);_defineProperty(this,"subscriptions",{});_defineProperty(this,"waitingSubscribes",{});_defineProperty(this,"pendingSubscribes",{});_defineProperty(this,"pendingUnsubscribes",{});_defineProperty(this,"options",void 0);_defineProperty(this,"subscriberIdGenerator",0);_defineProperty(this,"numberOfReconnections",0);_defineProperty(this,"categories",{});_defineProperty(this,"confirmedCategories",void 0);_defineProperty(this,"sentCategories",void 0);_defineProperty(this,"registerTimeout",void 0);_defineProperty(this,"logger",void 0);this.listener=e;this.defaultOptions=t;this.capabilities=n;this.callbackErrorHandler=i;this.confirmedCategories={};this.sentCategories={};this.options=t;this.logger=r?r.create("[Subscriptions]"):new tW;this.log("Created: options:",this.options)}return _createClass(Subscriptions,[{key:"close",value:function close(){this.log("Closed");this.alive=!1;this.cancelRegisterTimeout()}},{key:"isAttached",value:function isAttached(){return void 0!==this.connection}},{key:"isAuthenticated",value:function isAuthenticated(){return this.isAttached()&&void 0!==this.sessionId&&stringStartsWith(this.sessionId,"A")}},{key:"getOptions",value:function getOptions(){return this.options}},{key:"getSessionId",value:function getSessionId(){return this.sessionId}},{key:"getChannels",value:function getChannels(){return Object.keys(this.subscriptions)}},{key:"getSubscription",value:function getSubscription(e){return this.subscriptions[e]}},{key:"getWaitingSubscribes",value:function getWaitingSubscribes(){return Object.keys(this.waitingSubscribes)}},{key:"getPendingSubscribes",value:function getPendingSubscribes(){return Object.keys(this.pendingSubscribes)}},{key:"getPendingUnsubscribes",value:function getPendingUnsubscribes(){return Object.keys(this.pendingUnsubscribes)}},{key:"getNumberOfReconnections",value:function getNumberOfReconnections(){return this.numberOfReconnections}},{key:"subscribe",value:function subscribe(e,t,n){var i=this,r=(++this.subscriberIdGenerator).toString();return this.log("Subscriber added: channel:".concat(e)),this.addSubscriber(e,r,t,n),{close:function close(){i.log("Subscriber removed: channel:".concat(e));i.removeSubscriber(e,r)},update:function update(t){i.updateSubscriber(e,r,t)}}}},{key:"addCapabilities",value:function addCapabilities(e){var t=this,n=(++this.subscriberIdGenerator).toString();return this.log("Capabilities Added: id:".concat(e)),this.categories[n]={capabilities:e},this.checkCategories(),{close:function close(){t.log("Capabilities Removed: id:".concat(e));delete t.categories[n];t.checkCategories()}}}},{key:"addActivities",value:function addActivities(e){var t=this,n=(++this.subscriberIdGenerator).toString();return this.log("Activities Added: id:".concat(e)),this.categories[n]={activities:e},this.checkCategories(),{close:function close(){t.log("Activities Removed: id:".concat(e));delete t.categories[n];t.checkCategories()}}}},{key:"onAttach",value:function onAttach(e){if(this.alive){this.connection=e;var t=this.connection.getSessionId();this.log("Attached: sessionId:".concat(t));this.options=overrideOptions(this.defaultOptions,this.connection.getSessionOptions());if(void 0===this.sessionId){this.sessionId=t;this.listener.onConnect();this.checkCategories();this.attachToNewSession()}else{this.numberOfReconnections++;this.listener.onAttach();if(this.sessionId===t){this.attachToExistentSession();this.categoriesEquals(this.confirmedCategories,this.sentCategories)||this.pushCategories()}else{this.sessionId=t;this.attachToNewSession();this.pushCategories()}}}}},{key:"onUpdate",value:function onUpdate(e){this.alive&&(this.options=overrideOptions(this.defaultOptions,e))}},{key:"onDetach",value:function onDetach(){if(this.alive){this.log("Detached:");this.listener.onDetach();this.connection=void 0;this.getSubscriptions().forEach(function(e){return e.onDetach()})}}},{key:"onMessage",value:function onMessage(e,t,n){if(this.alive){this.log("Message: channel:".concat(e,", position:").concat(t,", message:"),n);var i=this.subscriptions[e];i&&i.onMessage(t,n)}}},{key:"onPosition",value:function onPosition(e,t){if(this.alive){this.log("Position: channelPattern:".concat(e,", position:").concat(t));var n=e,i="",r=e.indexOf("$");if(r>-1){n=e.substring(0,r);i=e.substring(r+1)}objectEntries(this.subscriptions).forEach(function(e){var r=_slicedToArray(e,2),s=r[0],o=r[1];stringStartsWith(s,n)&&stringEndsWith(s,i)&&o.setPosition(t)})}}},{key:"onSubscribed",value:function onSubscribed(e,t){if(this.alive){this.log("Subscribed: channel:".concat(e,", position:").concat(t));var n=this.subscriptions[e];if(n){delete this.pendingSubscribes[e];n.onAttach(t)}this.pushkWaitingSubscribes()}}},{key:"onUnsubscribed",value:function onUnsubscribed(e,n,i){var r=this;if(this.alive){this.log("Unsubscribed: channel:".concat(e,", reason:").concat(n));delete this.pendingUnsubscribes[e];var s=this.subscriptions[e];if(s){if(n>=500){s.onDetach();this.sendError(t.CHANNEL_FAILURE);setTimeout(function(){r.sendSubscribe(e,s.getPosition())},i||this.options.subscribeRetryTimoutMs)}else if(n>=400){var o=createSubscriptionFailure(n,e,{sessionId:this.sessionId});s.onFailure(o);this.removeSubscription(e)}else if(204===n){s.onComplete();this.removeSubscription(e)}}}}},{key:"onRegistered",value:function onRegistered(e,t){if(this.alive){this.confirmedCategories={capabilities:e,activities:t};this.log("Registered: categories:",this.confirmedCategories);this.categoriesEquals(this.confirmedCategories,this.sentCategories)&&this.cancelRegisterTimeout()}}},{key:"addSubscriber",value:function addSubscriber(e,t,n,i){this.connection||this.log("Connection is not ready yet");if(!this.hasSubscription(e)){this.createSubscription(e);this.sendSubscribe(e)}this.subscriptions[e].addSubscriber(t,n,i);this.categoriesNonEmpty(i)&&this.checkCategories()}},{key:"updateSubscriber",value:function updateSubscriber(e,t,n){var i=this.subscriptions[e];if(i){i.updateSubscriber(t,n);this.checkCategoriesNow()}}},{key:"removeSubscriber",value:function removeSubscriber(e,t){var n=this.subscriptions[e];if(n){n.removeSubscriber(t);if(n.isEmpty()){this.removeSubscription(e);this.sendUnsubscribe(e);this.pushkWaitingSubscribes();this.checkCategoriesNow()}}}},{key:"getCategories",value:function getCategories(){var e=new tJ;return e.add({capabilities:this.capabilities}),objectValues(this.categories).forEach(function(t){return e.add(t)}),objectValues(this.subscriptions).forEach(function(t){e.add(t.getCategories())}),e.get()}},{key:"attachToExistentSession",value:function attachToExistentSession(){var e=this;objectEntries(this.subscriptions).forEach(function(t){var n=_slicedToArray(t,2),i=n[0],r=n[1];e.pendingSubscribes[i]?e.sendSubscribe(i,r.getPosition()):r.onAttach()})}},{key:"attachToNewSession",value:function attachToNewSession(){var e=this;this.waitingSubscribes={};this.pendingSubscribes={};this.pendingUnsubscribes={};objectEntries(this.subscriptions).forEach(function(t){var n=_slicedToArray(t,2),i=n[0],r=n[1];return e.sendSubscribe(i,r.getPosition())})}},{key:"getSubscriptions",value:function getSubscriptions(){return objectValues(this.subscriptions)}},{key:"sendError",value:function sendError(e){this.connection&&e!==t.CHANNEL_FAILURE&&this.closeConnection(!1,e)}},{key:"sendSubscribe",value:function sendSubscribe(e,n){var i=this,r=Date.now();if(!this.pendingSubscribes.hasOwnProperty(e)&&Object.keys(this.pendingSubscribes).length>=this.options.maxPendingRequests){this.waitingSubscribes[e]=r;return}this.log("Subscribe: channel:".concat(e,", position:").concat(n));delete this.waitingSubscribes[e];this.pendingSubscribes[e]=r;if(this.connection){n?this.connection.subscribe(e,n):this.connection.subscribe(e);setTimeout(function(){i.alive&&i.pendingSubscribes[e]===r&&i.sendError(t.SUBSCRIBE_TIMEOUT)},this.options.responseMaxDelayMs)}}},{key:"sendUnsubscribe",value:function sendUnsubscribe(e){var n=this;this.log("Unsubscribe: channel:".concat(e));var i=Date.now();this.pendingUnsubscribes[e]=i;if(this.connection){this.connection.unsubscribe(e);setTimeout(function(){if(n.alive&&n.pendingUnsubscribes[e]===i){delete n.pendingUnsubscribes[e];n.sendError(t.UNSUBSCRIBE_TIMEOUT)}},this.options.responseMaxDelayMs)}}},{key:"sendRegister",value:function sendRegister(e){this.log("Register: categories:",e);if(this.connection){this.sentCategories=e;this.connection.register(e.capabilities,e.activities);this.startRegisterTimeout()}}},{key:"startRegisterTimeout",value:function startRegisterTimeout(){var e=this;this.cancelRegisterTimeout();this.registerTimeout=setTimeout(function(){e.alive&&!e.categoriesEquals(e.confirmedCategories,e.sentCategories)&&e.sendError(t.REGISTER_TIMEOUT)},this.options.responseMaxDelayMs)}},{key:"cancelRegisterTimeout",value:function cancelRegisterTimeout(){if(this.registerTimeout){clearTimeout(this.registerTimeout);this.registerTimeout=void 0}}},{key:"pushkWaitingSubscribes",value:function pushkWaitingSubscribes(){if(Object.keys(this.waitingSubscribes).length>0){var e=Object.keys(this.waitingSubscribes)[0];this.sendSubscribe(e,this.subscriptions[e].getPosition())}}},{key:"hasSubscription",value:function hasSubscription(e){return void 0!==this.subscriptions[e]}},{key:"createSubscription",value:function createSubscription(e){delete this.pendingUnsubscribes[e];this.subscriptions[e]=new tY(e,this.callbackErrorHandler,this.logger)}},{key:"removeSubscription",value:function removeSubscription(e){delete this.subscriptions[e];delete this.waitingSubscribes[e];delete this.pendingSubscribes[e];this.checkCategoriesNow()}},{key:"pushCategories",value:function pushCategories(){this.sentCategories=void 0;this.sendRegister(this.getCategories())}},{key:"checkCategories",value:function checkCategories(){var e=this;this.options.registerDelayMs?setTimeout(function(){return e.checkCategoriesNow()},this.options.registerDelayMs):this.checkCategoriesNow()}},{key:"checkCategoriesNow",value:function checkCategoriesNow(){var e=this.getCategories();this.categoriesEquals(this.sentCategories,e)||this.sendRegister(e)}},{key:"categoriesNonEmpty",value:function categoriesNonEmpty(e){return e&&(e.capabilities&&e.capabilities.length>0||e.activities&&objectKeys(e.activities).length>0)}},{key:"categoriesEquals",value:function categoriesEquals(e,t){return this.capabilitiesEquals(e,t)&&this.activitiesEquals(e,t)}},{key:"capabilitiesEquals",value:function capabilitiesEquals(e,t){var n=e&&e.capabilities?e.capabilities:[],i=t&&t.capabilities?t.capabilities:[],r=newSetFromArray(n),s=newSetFromArray(i);return this.setEquals(r,s)}},{key:"activitiesEquals",value:function activitiesEquals(e,t){var n=this,i=e&&e.activities?e.activities:{},r=t&&t.activities?t.activities:{},s=objectKeys(i),o=objectKeys(r);if(s.length!==o.length)return!1;var a=!0,c=newSetFromArray(o);return objectEntries(i).forEach(function(e){var t=_slicedToArray(e,2),r=t[0],s=t[1];c.has(r)||(a=!1);if(a){var o=newSetFromArray(s),l=newSetFromArray(i[r]);n.setEquals(o,l)||(a=!1)}}),a}},{key:"setEquals",value:function setEquals(e,t){if(e.size!==t.size)return!1;var n=!0;return e.forEach(function(e){t.has(e)||(n=!1)}),n}},{key:"closeConnection",value:function closeConnection(e,t){if(this.connection){this.connection.close(e,t);this.connection=void 0}}},{key:"log",value:function log(){var e;(e=this.logger).log.apply(e,arguments)}}])}(),t1={},t2={},t5={},t6={};Object.defineProperty(t6,"__esModule",{value:!0});t6.assert=function assert(e,t){if(!e)throw Error(t?"assertion failed: "+t:"assertion failed")};t6.getGlobal=function getGlobal(){var e;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==b)return b;try{e=Function("return this")()}catch(e){}return e};!function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=t6,n=function(){function CallQueue(){this.length=0;this._max=1e3;this._first=0}return CallQueue.prototype.push=function(e,t){return this[this.length++]=e,this[this.length++]=t,this.length<this._max},CallQueue.prototype.flush=function(){for(;this._first<this.length;){var e=this[this._first],t=this[this._first+1];this[this._first]=this[this._first+1]=void 0;this._first+=2;e(t)}this.length=0;this._first=0},CallQueue.prototype.empty=function(){return this._first===this.length},CallQueue}(),i=function(){function Ring(e){this._ring=[new n];this._current=this._ring[0];this._pool=e}return Ring.prototype.enqueue=function(e,t){if(!this._current){this._current=this._pool.pop();this._current||(this._current=new n);this._ring.push(this._current)}this._current.push(e,t)||(this._current=void 0)},Ring.prototype.flush=function(){for(;;){this._ring[0].flush();if(1===this._ring.length)break;this._pool.push(this._ring.shift())}this._current=this._ring[0]},Ring.prototype.empty=function(){return 1===this._ring.length&&this._ring[0].empty()},Ring}();function defaultScheduler(e){"function"==typeof setImmediate?setImmediate(e):setTimeout(e,0)}var r=function(){function Async(){var e=this;this._pool=[];this._mainRing=new i(this._pool);this._idleRing=new i(this._pool);this._flushing=!1;this._scheduled=!1;this._scheduler=void 0;this._flusher=function(){return e._scheduledFlush()}}return Async.prototype.setScheduler=function(e){t.assert(null==e||"function"==typeof e);this._scheduler=e},Async.prototype.enqueue=function(e,t){this._flushing||this._scheduled||this._schedule();this._mainRing.enqueue(e,t)},Async.prototype.enqueueIdle=function(e,t){this._flushing||this._scheduled||this._schedule();this._idleRing.enqueue(e,t)},Async.prototype.flush=function(){t.assert(!this._flushing,"cannot recursively flush");this._flushing=!0;try{for(;;){this._mainRing.flush();if(this._idleRing.empty())break;var e=this._mainRing;this._mainRing=this._idleRing;this._idleRing=e}}finally{this._flushing=!1;this._mainRing.empty()&&this._idleRing.empty()||this._scheduled||this._schedule()}},Async.prototype._schedule=function(){t.assert(!this._scheduled);(this._scheduler||defaultScheduler)(this._flusher);this._scheduled=!0},Async.prototype._scheduledFlush=function(){this._scheduled=!1;this.flush()},Async}();e.Async=r;e.async=new r;e.default=e.async}(t5);var t3={},t8={},t4=b&&b.__extends||function(){var _extendStatics=function(e,t){return(_extendStatics=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){_extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();Object.defineProperty(t8,"__esModule",{value:!0});t8.default=function(e){t4(BaseError,e);function BaseError(t,n){var i=this.constructor,r=e.call(this,n)||this,s=!1;if(r.constructor!==i){Object.setPrototypeOf&&Object.setPrototypeOf(r,i.prototype);s=!0}"stack"in r||(s=!0);r.name=t;if(s)if(Error.captureStackTrace)Error.captureStackTrace(r,i);else{var o=Error(n);o.name=t;try{throw o}catch(e){r.stack=e.stack||String(e)}}return r}return BaseError}(Error);var t7=b&&b.__extends||function(){var _extendStatics=function(e,t){return(_extendStatics=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){_extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();Object.defineProperty(t3,"__esModule",{value:!0});var t9=function(e){t7(BaseUnhandledRejection,e);function BaseUnhandledRejection(t,n,i){var r=e.call(this,t,n+": "+i)||this;r.reason=i;var s=r.reason&&"object"===_typeof(r.reason)&&r.reason.stack;return"string"!=typeof s&&(s=String(r.reason)),r.stack=r.name+": "+s,r}return BaseUnhandledRejection}(t8.default);t3.BaseUnhandledRejection=t9;var ne=function(e){t7(UnhandledRejection,e);function UnhandledRejection(t,n){var i=e.call(this,"UnhandledRejection","unhandled rejection",t)||this;return i.trace=n,i}return UnhandledRejection}(t9);t3.UnhandledRejection=ne;var nt=function(e){t7(PossiblyUnhandledRejection,e);function PossiblyUnhandledRejection(t){var n=e.call(this,"PossiblyUnhandledRejection","possibly unhandled rejection",t.reason())||this;return n.promise=t,n}return PossiblyUnhandledRejection}(t9);t3.PossiblyUnhandledRejection=nt;function emitRejectionEvent(e,t,n){var i=new PromiseRejectionEvent(e,{cancelable:!0,promise:!0,reason:t});Object.defineProperty(i,"promise",{value:n});var r=t6.getGlobal();return!(!r.dispatchEvent||r.dispatchEvent(i))}t3.defaultUnhandledRejectionHandler=function defaultUnhandledRejectionHandler(e,t){var n=new ne(e,t);throw n};t3.defaultPossiblyUnhandledRejectionHandler=function defaultPossiblyUnhandledRejectionHandler(e){var t=!0;void 0!==y&&"function"==typeof y.emit?y.emit("unhandledRejection",e.reason(),e)&&(t=!1):"function"==typeof PromiseRejectionEvent&&emitRejectionEvent("unhandledrejection",e.reason(),e)&&(t=!1);t&&console.warn(new nt(e).stack)};t3.defaultPossiblyUnhandledRejectionHandledHandler=function defaultPossiblyUnhandledRejectionHandledHandler(e){void 0!==y&&"function"==typeof y.emit?y.emit("rejectionHandled",e):"function"==typeof PromiseRejectionEvent&&emitRejectionEvent("rejectionhandled",e.reason(),e)};var nn={},ni={};Object.defineProperty(ni,"__esModule",{value:!0});var nr="function"==typeof Error.captureStackTrace;ni.default=function(){function Stack(e){void 0===e&&(e=Stack);nr?Error.captureStackTrace(this,e):this.stack="dummy\n<no trace>"}return Stack.prototype.inspect=function(){var e=this.stack.split("\n");return e.shift(),e.join("\n")},Stack}();Object.defineProperty(nn,"__esModule",{value:!0});nn.default=function(){function Trace(e){void 0===e&&(e=Trace);this.stack=new ni.default(e)}return Trace.prototype.setSource=function(e){if(e.sources){this.sources=e.sources.concat(e.stack);this.sources.length>Trace.traceLimit&&(this.sources=this.sources.slice(0,Trace.traceLimit))}else this.sources=[e.stack]},Trace.prototype.inspect=function(){var e=this.stack.inspect();if(this.sources)for(var t=this.sources.length-1;t>=0;t--)e+="\n  from previous:\n"+this.sources[t].inspect();return e},Trace.traceLimit=10,Trace}();Object.defineProperty(t2,"__esModule",{value:!0});var ns=t5,no=t3,na=nn,nc=t6,nl=!1;!function(e){e[e.Pending=0]="Pending";e[e.Fulfilled=1]="Fulfilled";e[e.Rejected=2]="Rejected"}(d||(d={}));!function(e){e[e.RejectionHandled=1]="RejectionHandled";e[e.UnhandledRejectionNotified=2]="UnhandledRejectionNotified"}(_||(_={}));function internalResolver(e,t){}function noop(){}var nu={error:void 0};function wrapNonError(e){return e}var nh=new na.default,nf=0,nd=function(){function Promise(e){var t=this;this._id=nf++;this._state=0;this._result=void 0;this._handlers=void 0;this._flags=0;this._trace=void 0;f&&f(this,"construct");if(nl){this._trace=new na.default(Promise);p&&this._setSource(p)}if(e!==internalResolver){if("function"!=typeof e)throw TypeError("Promise resolver is not a function");var n=!1;try{e(function(e){if(!n){n=!0;t._resolve(e)}},function(e){if(!n){n=!0;t._reject(wrapNonError(e))}})}catch(e){if(!n){n=!0;this._reject(wrapNonError(e))}}}}return Promise.prototype.then=function(e,t){f&&f(this,"then("+_typeof(e)+", "+_typeof(t)+")");if(1===this._state&&"function"!=typeof e||2===this._state&&"function"!=typeof t)return this;var n=new(Object.getPrototypeOf(this)).constructor(internalResolver);return n._setSource(this),this._enqueue(e,t,n,void 0),n},Promise.prototype.done=function(e,t){f&&f(this,"done("+_typeof(e)+", "+_typeof(t)+")");if(1!==this._state||"function"==typeof e){var n=nh;if(nl){n=new na.default;this._trace&&n.setSource(this._trace)}this._enqueue(e,t,void 0,n)}},Promise.prototype.catch=function(){if(1==arguments.length){var e=arguments[0];return this.then(void 0,e)}var t=arguments[0],n=arguments[1];return this.then(void 0,function(e){var i=!1;if("function"==typeof t)i=t.prototype instanceof Error||t===Error?e instanceof t:t(e);else if(Array.isArray(t))for(var r=0,s=t;r<s.length;r++){var o=s[r];if(e instanceof o){i=!0;break}}else throw TypeError("invalid predicate to .catch(), got "+_typeof(t));return i?n(e):Promise.reject(e)})},Promise.prototype.finally=function(e){var t=this,runner=function(){return e(t)};return this.then(runner,runner).return(this)},Promise.prototype.isFulfilled=function(){return 1===this._state},Promise.prototype.isRejected=function(){return 2===this._state},Promise.prototype.isPending=function(){return 0===this._state},Promise.prototype.value=function(){if(!this.isFulfilled())throw Error("Promise is not fulfilled");return this._result},Promise.prototype.reason=function(){if(!this.isRejected())throw Error("Promise is not rejected");return this._result},Promise.prototype.suppressUnhandledRejections=function(){this._setRejectionHandled()},Promise.prototype.inspect=function(){return this.toString()},Promise.prototype.toString=function(){var e;switch(this._state){case 0:e="pending";break;case 1:e="fulfilled";break;case 2:e="rejected";break;default:e="unknown"}return"[Promise "+this._id+": "+e+"]"},Promise.prototype.delay=function(e){return this.then(function(t){return new Promise(function(n){setTimeout(function(){return n(t)},e)})})},Promise.prototype.return=function(e){return void 0===e?this.then(noop):this.then(function(){return e})},Promise.prototype.throw=function(e){return this.then(function(){return Promise.reject(e)})},Promise.prototype._setSource=function(e){this._trace&&e._trace&&this._trace.setSource(e._trace)},Promise.prototype._resolve=function(e){nc.assert(0===this._state);if(!e)return void this._fulfill(e);if(this===e)return void this._reject(TypeError("cannot resolve Promise to self"));if(e instanceof Promise){e._setSource(this);e._setRejectionHandled();0===e._state?this._followPromise(e):1===e._state?this._fulfill(e._result):this._reject(e._result);return}if("object"===_typeof(e)||"function"==typeof e){var t=this._tryGetThen(e);if(t===nu)return void this._reject(wrapNonError(nu.error));if("function"==typeof t)return void this._followThenable(e,t)}this._fulfill(e)},Promise.prototype._tryGetThen=function(e){try{return e.then}catch(e){nu.error=e;return nu}},Promise.prototype._fulfill=function(e){nc.assert(0===this._state);f&&f(this,"_fulfill("+_typeof(e)+")");this._state=1;this._result=e;this._flush()},Promise.prototype._reject=function(e){nc.assert(0===this._state);f&&f(this,"_reject("+e+")");this._state=2;this._result=e;if(this._trace&&this._result instanceof Error&&!this._result.trace){var t=this._trace;this._result.trace=t;var n=this._result.stack;n&&Object.defineProperty(this._result,"stack",{enumerable:!1,get:function get(){return n+"\n  from Promise at:\n"+t.inspect()}})}1&this._flags||ns.default.enqueueIdle(Promise._unhandledRejectionChecker,this);this._flush()},Promise.prototype._setRejectionHandled=function(){!(1&this._flags)&&2&this._flags&&ns.default.enqueue(Promise._onPossiblyUnhandledRejectionHandledHandler,this);this._flags|=1;f&&f(this,"rejectionHandled")},Promise.prototype._doCheckUnhandledRejection=function(){if(!(1&this._flags)&&!(2&this._flags)){this._flags|=2;ns.default.enqueue(Promise._onPossiblyUnhandledRejectionHandler,this)}},Promise.prototype._followPromise=function(e){nc.assert(0===this._state);f&&f(this,"_follow([Promise "+e._id+"])");e._enqueue(void 0,void 0,this,void 0)},Promise.prototype._followThenable=function(e,t){var n=this;nc.assert(0===this._state);f&&f(this,"_follow([Thenable])");var i=!1;try{t.call(e,function(e){if(!i){i=!0;n._resolve(e)}},function(e){if(!i){i=!0;n._reject(wrapNonError(e))}})}catch(e){if(!i){i=!0;this._reject(wrapNonError(e))}}},Promise.prototype._enqueue=function(e,t,n,i){var r={promise:this,onFulfilled:e,onRejected:t,slave:n,done:i};if(0!==this._state)ns.default.enqueue(Promise._unwrapper,r);else if(this._handlers){var s=this._handlers.length;this._handlers[s]=r}else this._handlers=[r];this._setRejectionHandled()},Promise.prototype._flush=function(){if(this._handlers){var e=0,t=this._handlers,n=t.length;this._handlers=void 0;for(;e<n;)ns.default.enqueue(Promise._unwrapper,t[e++])}},Promise.prototype._unwrap=function(e){var t=1===this._state?e.onFulfilled:e.onRejected;if(e.done){f&&f(this,"_unwrap()");if("function"!=typeof t){2===this._state&&Promise._onUnhandledRejectionHandler(this._result,e.done);return}nc.assert(!p);p=this;try{var n=t(this._result);n&&(n instanceof Promise?n:Promise.resolve(n)).done();p=void 0}catch(t){p=void 0;Promise._onUnhandledRejectionHandler(t,e.done)}return}var i=e.slave;f&&f(this,"_unwrap("+i._id+")");if("function"==typeof t){nc.assert(!p);p=i;try{i._resolve(t(this._result))}catch(e){i._reject(wrapNonError(e))}p=void 0}else 1===this._state?i._fulfill(this._result):i._reject(this._result)},Promise.resolve=function(e){var t=new Promise(internalResolver);return t._resolve(e),t},Promise.reject=function(e){var t=new Promise(internalResolver);return t._reject(e),t},Promise.all=function(e){return new Promise(function(t,n){nc.assert(Array.isArray(e),"thenables must be an Array");if(0===e.length)return void t([]);for(var i=Array(e.length),r=e.length,s=0;s<e.length;s++)follow(e[s],s);function follow(e,s){(e instanceof Promise?e:Promise.resolve(e)).done(function(e){i[s]=e;r--;0===r&&t(i)},function(e){return n(e)})}})},Promise.race=function(e){return new Promise(function(t,n){nc.assert(Array.isArray(e),"thenables must be an Array");for(var i=0,r=e;i<r.length;i++){var s=r[i],o=s instanceof Promise?s:Promise.resolve(s);Promise.resolve(o).done(t,n)}})},Promise.defer=function(){var e,t;return{promise:new Promise(function(n,i){e=n;t=i}),reject:t,resolve:e}},Promise.delay=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(void 0===arguments[1]){var n=arguments[0];return new Promise(function(e){setTimeout(e,n)})}return Promise.resolve(arguments[0]).delay(arguments[1])},Promise.onUnhandledRejection=function(e){if(!0===e)Promise._onUnhandledRejectionHandler=no.defaultUnhandledRejectionHandler;else if(!1===e)Promise._onUnhandledRejectionHandler=noop;else if("function"!=typeof e)throw TypeError("invalid handler: boolean or function expected");else Promise._onUnhandledRejectionHandler=e},Promise.onPossiblyUnhandledRejection=function(e){if(!0===e)Promise._onPossiblyUnhandledRejectionHandler=no.defaultPossiblyUnhandledRejectionHandler;else if(!1===e)Promise._onPossiblyUnhandledRejectionHandler=noop;else if("function"!=typeof e)throw TypeError("invalid handler: boolean or function expected");else Promise._onPossiblyUnhandledRejectionHandler=e},Promise.onPossiblyUnhandledRejectionHandled=function(e){if(!0===e)Promise._onPossiblyUnhandledRejectionHandledHandler=no.defaultPossiblyUnhandledRejectionHandledHandler;else if(!1===e)Promise._onPossiblyUnhandledRejectionHandledHandler=noop;else if("function"!=typeof e)throw TypeError("invalid handler: boolean or function expected");else Promise._onPossiblyUnhandledRejectionHandledHandler=e},Promise.setLongTraces=function(e){nl=e},Promise.setTracer=function(e){f="function"==typeof e?e:void 0},Promise.flush=function(){ns.default.flush()},Promise._unwrapper=function(e){e.promise._unwrap(e)},Promise._unhandledRejectionChecker=function(e){e._doCheckUnhandledRejection()},Promise}();t2.Promise=nd;nd.onUnhandledRejection(!0);nd.onPossiblyUnhandledRejection(!0);nd.onPossiblyUnhandledRejectionHandled(!0);t2.default=nd;var n_={};Object.defineProperty(n_,"__esModule",{value:!0});var np=t2;n_.default=function polyfill(e){void 0===e&&(e=!1);var t=t6.getGlobal();return!!t&&(e||"function"!=typeof t.Promise?(t.Promise=np.Promise,!0):t.Promise instanceof np.Promise)};Object.defineProperty(t1,"__esModule",{value:!0});var nv=t2,ny=t1.default=nv.default;t1.Promise=nv.Promise;t1.Trace=nn.default;var nb=t3;t1.UnhandledRejection=nb.UnhandledRejection;t1.PossiblyUnhandledRejection=nb.PossiblyUnhandledRejection;t1.UnhandledRejectionError=t3.UnhandledRejection;t1.polyfill=n_.default;t1.BaseError=t8.default;var ng=function(){function Timer(){_classCallCheck(this,Timer)}return _createClass(Timer,[{key:"schedule",value:function schedule(e){return new ny(function(t){setTimeout(t,e)})}}])}(),nm={},nw={};Object.defineProperty(nw,"__esModule",{value:!0});nw.BaseEvent=function(){function BaseEvent(){}return BaseEvent.prototype.attach=function(e,t){return this._attach(e,t,!1)},BaseEvent.prototype.once=function(e,t){return this._attach(e,t,!0)},BaseEvent.prototype._attach=function(e,t,n){var i,r,s,o,a=this;if("function"==typeof e){r=e;o=function result(){return a.detach(r)}}else if(t||"function"!=typeof e.post){if("object"!==_typeof(e)||void 0===e)throw Error("Expect a function or object as first argument");if("function"!=typeof t)throw Error("Expect a function as second argument");i=e;r=t;o=function result(){return a.detach(i,r)}}else{s=e;o=function result(){return a.detach(s)}}return this._listeners?this._listeners=this._listeners.slice():this._listeners=[],this._listeners.push({deleted:!1,boundTo:i,handler:r,event:s,once:n}),o},BaseEvent.prototype.detach=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._detach.apply(this,e)},BaseEvent.prototype._detach=function(){for(var e,t,n,i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];if(this._listeners&&0!==this._listeners.length){i.length>=1&&("function"==typeof i[0]?t=i[0]:1===i.length&&"function"==typeof i[0].post?n=i[0]:e=i[0]);i.length>=2&&(t=i[1]);this._listeners=this._listeners.filter(function(i){return void 0!==t&&i.handler!==t||void 0!==n&&i.event!==n||void 0!==e&&i.boundTo!==e||(i.deleted=!0,!1)});0===this._listeners.length&&delete this._listeners}},BaseEvent.prototype.post=function(e){throw Error("abstract")},BaseEvent.prototype.listenerCount=function(){return this._listeners?this._listeners.length:0},BaseEvent.prototype._call=function(e,t){if(this._listeners&&!e.deleted){if(e.once){e.deleted=!0;this._listeners=this._listeners.filter(function(t){return t!==e});0===this._listeners.length&&delete this._listeners}e.event?e.event.post.apply(e.event,t):e.handler&&e.handler.apply("object"===_typeof(e.boundTo)?e.boundTo:this,t)}},BaseEvent}();var nk={},nE=b&&b.__extends||function(){var _extendStatics=function(e,t){return(_extendStatics=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){_extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();Object.defineProperty(nk,"__esModule",{value:!0});var nS=function(e){nE(SyncEvent,e);function SyncEvent(){var t=null!==e&&e.apply(this,arguments)||this;return t._recursion=0,t}return Object.defineProperty(SyncEvent.prototype,"evtListenersChanged",{get:function get(){return this._listenersChanged||(this._listenersChanged=new nC),this._listenersChanged},enumerable:!0,configurable:!0}),SyncEvent.prototype.post=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(this._listeners&&0!==this._listeners.length){this._recursion++;if("number"==typeof SyncEvent.MAX_RECURSION_DEPTH&&Number.isInteger(SyncEvent.MAX_RECURSION_DEPTH)&&SyncEvent.MAX_RECURSION_DEPTH>0&&this._recursion>SyncEvent.MAX_RECURSION_DEPTH)throw Error("event fired recursively");for(var n=this._listeners,i=0;i<n.length;++i){var r=n[i];this._call(r,e)}this._recursion--}},SyncEvent.prototype._attach=function(t,n,i){var r,s,o,a,c=null!=(s=null==(r=this._listeners)?void 0:r.length)?s:0,l=e.prototype._attach.call(this,t,n,i);return this.evtListenersChanged&&c!==(null!=(a=null==(o=this._listeners)?void 0:o.length)?a:0)&&this.evtListenersChanged.post(),l},SyncEvent.prototype._detach=function(){for(var t,n,i,r,s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var a=null!=(n=null==(t=this._listeners)?void 0:t.length)?n:0,c=e.prototype._detach.apply(this,s);return this.evtListenersChanged&&a!==(null!=(r=null==(i=this._listeners)?void 0:i.length)?r:0)&&this.evtListenersChanged.post(),c},SyncEvent.MAX_RECURSION_DEPTH=10,SyncEvent}(nw.BaseEvent);nk.SyncEvent=nS;var nC=function(e){nE(VoidSyncEvent,e);function VoidSyncEvent(){return null!==e&&e.apply(this,arguments)||this}return VoidSyncEvent.prototype.post=function(){e.prototype.post.call(this,void 0)},VoidSyncEvent}(nS);nk.VoidSyncEvent=nC;nk.ErrorSyncEvent=function(e){nE(ErrorSyncEvent,e);function ErrorSyncEvent(){return null!==e&&e.apply(this,arguments)||this}return ErrorSyncEvent.prototype.post=function(t){if(0===this.listenerCount())throw Error("error event posted while no listeners attached. Error: "+t.message);e.prototype.post.call(this,t)},ErrorSyncEvent}(nS);var nP={},nO={};Object.defineProperty(nO,"__esModule",{value:!0});var nA=nk;nO.default=function(){function EventQueue(){this.evtFilled=new nA.SyncEvent;this.evtDrained=new nA.SyncEvent;this._queue=[];this._flushing=!1}return EventQueue.global=function(){return EventQueue._instance||EventQueue.resetGlobal(),EventQueue._instance},EventQueue.resetGlobal=function(){EventQueue._instance=new EventQueue},EventQueue.prototype.empty=function(){return 0===this._queue.length},EventQueue.prototype.add=function(e){this._queue.push(e);1!==this._queue.length||this._flushing||this.evtFilled.post(this)},EventQueue.prototype.flushOnce=function(){var e=0===this._queue.length,t=this._flushing;this._flushing=!0;try{var n=this._queue;this._queue=[];for(var i=0;i<n.length;++i)n[i]()}finally{this._flushing=t;e||t||0!==this._queue.length||this.evtDrained.post(this)}},EventQueue.prototype.flush=function(e){void 0===e&&(e=10);var t=0===this._queue.length,n=this._flushing;this._flushing=!0;try{for(var i=0;this._queue.length>0;){if("number"==typeof e&&i>=e){this._queue=[];throw Error("unable to flush the queue due to recursively added event. Clearing queue now")}this.flushOnce();++i}}finally{this._flushing=n;t||n||0!==this._queue.length||this.evtDrained.post(this)}},EventQueue}();var nR=b&&b.__extends||function(){var _extendStatics=function(e,t){return(_extendStatics=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){_extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();Object.defineProperty(nP,"__esModule",{value:!0});var nT=function(e){nR(QueuedEvent,e);function QueuedEvent(t){void 0===t&&(t={});var n=e.call(this)||this;return n._queued=!1,n.options=t,"boolean"==typeof t.condensed?n._condensed=t.condensed:n._condensed=!1,"object"===_typeof(t.queue)&&null!==t.queue&&(n._queue=t.queue),n}return Object.defineProperty(QueuedEvent.prototype,"evtListenersChanged",{get:function get(){return this._listenersChanged||(this._listenersChanged=new nk.VoidSyncEvent),this._listenersChanged},enumerable:!0,configurable:!0}),QueuedEvent.prototype.post=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(this._listeners&&0!==this._listeners.length){var i=this._queue?this._queue:nO.default.global();if(this._condensed){this._queuedData=t;this._queuedListeners=this._listeners;if(this._queued)return;this._queued=!0;i.add(function(){e._queued=!1;for(var t=e._queuedData,n=e._queuedListeners,i=0;i<n.length;++i){var r=n[i];e._call(r,t)}})}else{var r=this._listeners;i.add(function(){for(var n=0;n<r.length;++n){var i=r[n];e._call(i,t)}})}}},QueuedEvent.prototype._attach=function(t,n,i){var r,s,o,a,c=null!=(s=null==(r=this._listeners)?void 0:r.length)?s:0,l=e.prototype._attach.call(this,t,n,i);return this.evtListenersChanged&&c!==(null!=(a=null==(o=this._listeners)?void 0:o.length)?a:0)&&this.evtListenersChanged.post(),l},QueuedEvent.prototype._detach=function(){for(var t,n,i,r,s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var a=null!=(n=null==(t=this._listeners)?void 0:t.length)?n:0,c=e.prototype._detach.apply(this,s);return this.evtListenersChanged&&a!==(null!=(r=null==(i=this._listeners)?void 0:i.length)?r:0)&&this.evtListenersChanged.post(),c},QueuedEvent}(nw.BaseEvent);nP.QueuedEvent=nT;nP.VoidQueuedEvent=function(e){nR(VoidQueuedEvent,e);function VoidQueuedEvent(){return null!==e&&e.apply(this,arguments)||this}return VoidQueuedEvent.prototype.post=function(){e.prototype.post.call(this,void 0)},VoidQueuedEvent}(nT);nP.ErrorQueuedEvent=function(e){nR(ErrorQueuedEvent,e);function ErrorQueuedEvent(){return null!==e&&e.apply(this,arguments)||this}return ErrorQueuedEvent.prototype.post=function(t){if(!this._listeners||0===this._listeners.length)throw Error("error event posted while no listeners attached. Error: "+t.message);e.prototype.post.call(this,t)},ErrorQueuedEvent}(nT);var nj={},nx=b&&b.__extends||function(){var _extendStatics=function(e,t){return(_extendStatics=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){_extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();Object.defineProperty(nj,"__esModule",{value:!0});var nI=function(e){nx(AsyncEvent,e);function AsyncEvent(t){void 0===t&&(t={});var n=e.call(this)||this;return n._queued=!1,n.options=t,"boolean"==typeof t.condensed?n._condensed=t.condensed:n._condensed=!1,n}return Object.defineProperty(AsyncEvent.prototype,"evtListenersChanged",{get:function get(){return this._listenersChanged||(this._listenersChanged=new nk.VoidSyncEvent),this._listenersChanged},enumerable:!0,configurable:!0}),AsyncEvent.defaultScheduler=function(e){"undefined"!=typeof window?setTimeout(e,0):setImmediate(e)},AsyncEvent.setScheduler=function(e){AsyncEvent._scheduler=e},AsyncEvent.prototype.post=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(this._listeners&&0!==this._listeners.length)if(this._condensed){this._queuedData=t;this._queuedListeners=this._listeners;if(this._queued)return;this._queued=!0;AsyncEvent._scheduler(function(){e._queued=!1;for(var t=e._queuedData,n=e._queuedListeners,i=0;i<n.length;++i){var r=n[i];e._call(r,t)}})}else{var i=this._listeners;AsyncEvent._scheduler(function(){for(var n=0;n<i.length;++n){var r=i[n];e._call(r,t)}})}},AsyncEvent.prototype._call=function(t,n){t.event&&t.event instanceof AsyncEvent?t.event._postDirect(n):e.prototype._call.call(this,t,n)},AsyncEvent.prototype._postDirect=function(e){if(this._listeners&&0!==this._listeners.length)for(var t=this._listeners,n=0;n<t.length;++n){var i=t[n];this._call(i,e)}},AsyncEvent.prototype._attach=function(t,n,i){var r,s,o,a,c=null!=(s=null==(r=this._listeners)?void 0:r.length)?s:0,l=e.prototype._attach.call(this,t,n,i);return this.evtListenersChanged&&c!==(null!=(a=null==(o=this._listeners)?void 0:o.length)?a:0)&&this.evtListenersChanged.post(),l},AsyncEvent.prototype._detach=function(){for(var t,n,i,r,s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var a=null!=(n=null==(t=this._listeners)?void 0:t.length)?n:0,c=e.prototype._detach.apply(this,s);return this.evtListenersChanged&&a!==(null!=(r=null==(i=this._listeners)?void 0:i.length)?r:0)&&this.evtListenersChanged.post(),c},AsyncEvent._scheduler=AsyncEvent.defaultScheduler,AsyncEvent}(nw.BaseEvent);nj.AsyncEvent=nI;nj.VoidAsyncEvent=function(e){nx(VoidAsyncEvent,e);function VoidAsyncEvent(){return null!==e&&e.apply(this,arguments)||this}return VoidAsyncEvent.prototype.post=function(){e.prototype.post.call(this,void 0)},VoidAsyncEvent}(nI);nj.ErrorAsyncEvent=function(e){nx(ErrorAsyncEvent,e);function ErrorAsyncEvent(){return null!==e&&e.apply(this,arguments)||this}return ErrorAsyncEvent.prototype.post=function(t){if(0===this.listenerCount())throw Error("error event posted while no listeners attached. Error: "+t.message);e.prototype.post.call(this,t)},ErrorAsyncEvent}(nI);var nD={},nU={};Object.defineProperty(nU,"__esModule",{value:!0});nU.shallowEquals=function shallowEquals(e,t){if(e===t)return!0;if(_typeof(e)!==_typeof(t))return!1;switch(_typeof(e)){case"boolean":case"number":case"string":case"function":case"symbol":case"undefined":default:return!1;case"object":if(null===e||null===t)return!1;if(Array.isArray(e)||Array.isArray(t)){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}var i=[],r=[];for(var s in e)e.hasOwnProperty(s)&&i.push(s);for(var o in t)t.hasOwnProperty(o)&&r.push(o);i.sort();r.sort();if(i.join(",")!==r.join(","))return!1;for(var n=0;n<i.length;++n)if(e[i[n]]!==t[i[n]])return!1;return!0}};!function(e){var t,n=b&&b.__extends||function(){var _extendStatics=function(e,t){return(_extendStatics=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){_extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=nU,r=nk,s=nj,o=nP;!function(e){e[e.Sync=0]="Sync";e[e.Async=1]="Async";e[e.Queued=2]="Queued"}(t=e.EventType||(e.EventType={}));var a=function(){function AnyEvent(e){this._events=[];if(e&&e.monitorAttach){this.evtFirstAttached=new c;this.evtLastDetached=new c}}return Object.defineProperty(AnyEvent.prototype,"evtListenersChanged",{get:function get(){return this._listenersChanged||(this._listenersChanged=new r.VoidSyncEvent),this._listenersChanged},enumerable:!0,configurable:!0}),AnyEvent.prototype.attach=function(){for(var e,n,i,r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];var o=t.Sync;r.length>0&&"number"==typeof r[0]&&(o=r.shift());var a=this;if("function"==typeof r[0]||r[0]&&"object"===_typeof(r[0])&&"function"==typeof r[0].post){"function"==typeof r[0]?e=r[0]:i=r[0];n=r[1]}else{a=r[0];e=r[1];n=r[2]}return this._attach(o,a,e,i,n,!1)},AnyEvent.prototype.once=function(){for(var e,n,i,r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];var o=t.Sync;r.length>0&&"number"==typeof r[0]&&(o=r.shift());var a=this;if("function"==typeof r[0]||r[0]&&"object"===_typeof(r[0])&&"function"==typeof r[0].post){"function"==typeof r[0]?e=r[0]:i=r[0];n=r[1]}else{a=r[0];e=r[1];n=r[2]}return this._attach(o,a,e,i,n,!0)},AnyEvent.prototype._attach=function(e,n,a,c,l,u){var h,f,d=this,_=this.evtFirstAttached?this.listenerCount():0;switch(e){case t.Sync:for(var p=0,v=this._events;p<v.length;p++){var y=v[p];y instanceof r.SyncEvent&&(h=y)}if(!h){h=new r.SyncEvent;this._events.push(h)}break;case t.Async:for(var b=0,g=this._events;b<g.length;b++){var y=g[b];y instanceof s.AsyncEvent&&i.shallowEquals(y.options,l)&&(h=y)}if(!h){h=new s.AsyncEvent(l);this._events.push(h)}break;case t.Queued:for(var m=0,w=this._events;m<w.length;m++){var y=w[m];y instanceof o.QueuedEvent&&i.shallowEquals(y.options,l)&&(h=y)}if(!h){h=new o.QueuedEvent(l);this._events.push(h)}break;default:throw Error("unknown EventType")}return f=u?c?h.once(c):h.once(n,a):c?h.attach(c):h.attach(n,a),this.evtFirstAttached&&0===_&&this.evtFirstAttached.post(),this.evtListenersChanged&&_!==this.listenerCount()&&this.evtListenersChanged.post(),function(){var e=d.evtLastDetached?d.listenerCount():0;f();d.evtLastDetached&&e>0&&0===d.listenerCount()&&d.evtLastDetached.post();d.evtListenersChanged&&e!==d.listenerCount()&&d.evtListenersChanged.post()}},AnyEvent.prototype.attachSync=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.unshift(t.Sync),this.attach.apply(this,e)},AnyEvent.prototype.onceSync=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.unshift(t.Sync),this.once.apply(this,e)},AnyEvent.prototype.attachAsync=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.unshift(t.Async),this.attach.apply(this,e)},AnyEvent.prototype.onceAsync=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.unshift(t.Async),this.once.apply(this,e)},AnyEvent.prototype.attachQueued=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.unshift(t.Queued),this.attach.apply(this,e)},AnyEvent.prototype.onceQueued=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.unshift(t.Queued),this.once.apply(this,e)},AnyEvent.prototype.detach=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this.listenerCount(),i=0;i<this._events.length;++i)this._events[i].detach.apply(this._events[i],e);this.evtListenersChanged&&n!==this.listenerCount()&&this.evtListenersChanged.post();this.evtLastDetached&&n>0&&0===this.listenerCount()&&this.evtLastDetached.post()},AnyEvent.prototype.post=function(e){for(var t=[],n=0;n<this._events.length;++n)t.push(this._events[n]);for(var n=0;n<t.length;++n)t[n].post(e)},AnyEvent.prototype.listenerCount=function(){for(var e=0,t=0;t<this._events.length;++t)e+=this._events[t].listenerCount();return e},AnyEvent}();e.AnyEvent=a;var c=function(e){n(VoidAnyEvent,e);function VoidAnyEvent(){return null!==e&&e.apply(this,arguments)||this}return VoidAnyEvent.prototype.post=function(){e.prototype.post.call(this,void 0)},VoidAnyEvent}(a);e.VoidAnyEvent=c;e.ErrorAnyEvent=function(e){n(ErrorAnyEvent,e);function ErrorAnyEvent(){return null!==e&&e.apply(this,arguments)||this}return ErrorAnyEvent.prototype.post=function(t){if(0===this.listenerCount())throw Error("error event posted while no listeners attached. Error: "+t.message);e.prototype.post.call(this,t)},ErrorAnyEvent}(a)}(nD);!function(e){function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0});__export(nw);__export(nk);__export(nP);__export(nj);__export(nD);var t=nO;e.EventQueue=nO.default;e.queue=function queue(){return t.default.global()};e.flushOnce=function flushOnce(){t.default.global().flushOnce()};e.flush=function flush(e){void 0===e&&(e=10);t.default.global().flush(e)}}(nm);!function(e){e.UNAUTHENTICATED=4001}(v||(v={}));var nM=function(){function Transport(e,t,n,i,r,o,a){var c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:new tW;_classCallCheck(this,Transport);_defineProperty(this,"connectionFactory",void 0);_defineProperty(this,"socketFactory",void 0);_defineProperty(this,"timer",void 0);_defineProperty(this,"url",void 0);_defineProperty(this,"params",void 0);_defineProperty(this,"defaultOptions",void 0);_defineProperty(this,"listener",void 0);_defineProperty(this,"logger",void 0);_defineProperty(this,"alive",!0);_defineProperty(this,"socketIdGenerator",0);_defineProperty(this,"numberOfConnectionAttempts",0);_defineProperty(this,"options",void 0);_defineProperty(this,"online",!0);_defineProperty(this,"quality",s.OFFLINE);_defineProperty(this,"qualityEvent",new nm.AsyncEvent);_defineProperty(this,"socket",void 0);_defineProperty(this,"connection",void 0);_defineProperty(this,"sessionId",void 0);_defineProperty(this,"sessionOffset",void 0);_defineProperty(this,"previousConnectionError",void 0);this.connectionFactory=e;this.socketFactory=t;this.timer=n;this.url=i;this.params=r;this.defaultOptions=o;this.listener=a;this.logger=c;this.options=o;this.log("Created: options:",this.options)}return _createClass(Transport,[{key:"getOptions",value:function getOptions(){return this.options}},{key:"setOnline",value:function setOnline(e){var n=this.online;this.online=e;if(!e&&n&&this.connection){this.closeConnection(t.CLIENT_OFFLINE);this.closeSocket()}!e&&n&&this.socket&&this.closeSocket();e&&!n&&this.reconnect()}},{key:"getQuality",value:function getQuality(){return this.quality}},{key:"addQualityListener",value:function addQualityListener(e){var t=this;return this.qualityEvent.attach(e),{close:function close(){t.qualityEvent.detach(e)}}}},{key:"getSocket",value:function getSocket(){return this.socket}},{key:"getConnection",value:function getConnection(){return this.connection}},{key:"getSessionId",value:function getSessionId(){return this.sessionId}},{key:"getSessionOffset",value:function getSessionOffset(){return this.sessionOffset}},{key:"connect",value:function connect(){this.assertNotClosed();var e=this.buildUrl();this.numberOfConnectionAttempts++;var t=++this.socketIdGenerator;this.log("#".concat(this.numberOfConnectionAttempts," attempt to open ").concat(e," as socket #").concat(t));this.socket=this.socketFactory.create(t,e,this)}},{key:"onOpen",value:function onOpen(e){if(this.isValidCallback(e)&&this.socket){this.connection=this.connectionFactory.create(this.socket,this.sessionId,this.sessionOffset);this.previousConnectionError=void 0;this.log("WS Connected")}}},{key:"onClose",value:function onClose(e,t){this.isValidCallback(e)&&this.reset(void 0,t)}},{key:"onError",value:function onError(e){this.isValidCallback(e)&&this.reset(t.CONNECTION_ERROR)}},{key:"onMessage",value:function onMessage(e,t){if(this.isValidCallback(e)&&this.connection){this.numberOfConnectionAttempts=0;this.setQuality(this.connection.onPacket(t))}}},{key:"isClosed",value:function isClosed(){return!this.alive}},{key:"close",value:function close(){if(this.alive){this.alive=!1;if(this.connection){this.connection.close(!0);this.connection=void 0;this.quality=s.OFFLINE}this.closeSocket();this.log("Closed")}}},{key:"reset",value:function reset(t,n){this.setQuality(s.OFFLINE);this.closeConnection(t);this.closeSocket();n===v.UNAUTHENTICATED?this.listener.onFailure(e.UNAUTHENTICATED):this.scheduleReconnection()}},{key:"assertNotClosed",value:function assertNotClosed(){if(!this.alive)throw Error("Transport already cosed")}},{key:"buildUrl",value:function buildUrl(){var e="".concat(this.url),t=0;return Object.entries(this.params).forEach(function(n){var i=_slicedToArray(n,2),r=i[0],s=i[1];if(s){e+=t++?"&":"?";e+=r+"="+s}}),this.sessionId&&(e+="&sid=".concat(this.sessionId,"&offset=").concat(this.sessionOffset)),this.previousConnectionError&&(e+="&disconnected_by=".concat(this.previousConnectionError)),e}},{key:"isValidCallback",value:function isValidCallback(e){return!!this.alive&&e===this.socketIdGenerator}},{key:"scheduleReconnection",value:function scheduleReconnection(){var e=this,t=this.numberOfConnectionAttempts,n=this.backOffDelayWithJitter(t);this.log("Scheduling #"+(t+1)+" reconnection attempt in "+n+" millisec");this.timer.schedule(n).then(function(){e.numberOfConnectionAttempts===t&&e.reconnect()})}},{key:"reconnect",value:function reconnect(){if(this.alive&&null==this.socket)try{this.connect()}catch(e){this.scheduleReconnection()}}},{key:"backOffDelayWithJitter",value:function backOffDelayWithJitter(e){if(!this.online)return this.options.maxReconnectionDelayMs;var t=this.backOffDelay(e);return this.options.reconnectionJitter?Math.max(this.options.initialReconnectionDelayMs,Math.floor(Math.random()*t)):t}},{key:"backOffDelay",value:function backOffDelay(e){return e<16?Math.min(this.options.initialReconnectionDelayMs*Math.pow(this.options.reconnectionDelayPowBase,e),this.options.maxReconnectionDelayMs):this.options.maxReconnectionDelayMs}},{key:"closeConnection",value:function closeConnection(e){if(this.connection){var t=this.connection.getSessionId();if(t){this.sessionId=t;this.sessionOffset=this.connection.getSessionOffset();this.options=overrideOptions(this.defaultOptions,this.connection.getSessionOptions())}this.previousConnectionError=this.connection.closedByError;e?this.connection.onError(e):this.connection.onClose();this.connection=void 0}}},{key:"closeSocket",value:function closeSocket(){if(this.socket){try{this.socket.close()}catch(e){this.log("Socket close error: socketId="+this.socketIdGenerator)}this.socket=void 0}}},{key:"setQuality",value:function setQuality(e){if(null!=e&&e!==this.quality){this.quality=e;this.qualityEvent.post(e)}}},{key:"log",value:function log(){for(var e,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=this.logger).log.apply(e,["[Transport]"].concat(n))}}])}(),nN=1.5,nB=function(){function Client(e,t,n){var i=this;_classCallCheck(this,Client);_defineProperty(this,"options",void 0);_defineProperty(this,"WS",void 0);_defineProperty(this,"id",void 0);_defineProperty(this,"subscriptions",void 0);_defineProperty(this,"listener",void 0);_defineProperty(this,"transport",void 0);_defineProperty(this,"logger",void 0);this.options=e;this.WS=n;this.id=e.clientId?e.clientId:this.generateId(8);var r=this,s=this.options.uid?""+this.options.uid:void 0;this.logger=new tW(!!this.options.debug&&this.options.debug);this.listener=new tG(t,this.options.callbackErrorHandler,this.logger);var o=this.subscriptionOptions();this.subscriptions=new t0({onConnect:function onConnect(){i.listener.onConnect(i.getOnConnectObject())},onAttach:function onAttach(){i.listener.onAttach()},onDetach:function onDetach(){i.listener.onDetach()}},o,this.options.capabilities,this.options.callbackErrorHandler,this.logger);var a=this.connectionOptions(),c=new tV(this.subscriptions,a,this.logger),l=new t$(function(e){return r.WS?new r.WS(e):new WebSocket(e)},this.logger),u=this.options.url,h={uid:s,token:this.options.token,client_type:"web",client_version:Client.version,client_id:this.id},f=window;f.context&&f.context.version&&(h.web_version=f.context.version);var d=this.transportOptions();this.transport=new nM(c,l,new ng,u,h,d,{onFailure:function onFailure(e){i.listener.onFailure(createClientFailure(e));i.close()}},this.logger)}return _createClass(Client,[{key:"getId",value:function getId(){return this.id}},{key:"getLogger",value:function getLogger(){return this.logger}},{key:"getState",value:function getState(){return{transport:{isConnected:this.isAttached()}}}},{key:"setOnline",value:function setOnline(e){this.transport.setOnline(e)}},{key:"getQuality",value:function getQuality(){return this.transport.getQuality()}},{key:"addQualityListener",value:function addQualityListener(e){return this.transport.addQualityListener(e)}},{key:"isAttached",value:function isAttached(){return this.subscriptions.isAttached()}},{key:"isAuthenticated",value:function isAuthenticated(){return this.subscriptions.isAuthenticated()}},{key:"addCapabilities",value:function addCapabilities(e){return this.subscriptions.addCapabilities(e)}},{key:"addActivities",value:function addActivities(e){return this.subscriptions.addActivities(e)}},{key:"isClosed",value:function isClosed(){return this.transport.isClosed()}},{key:"close",value:function close(){this.subscriptions.close();this.transport.close()}},{key:"connect",value:function connect(){if(!this.isWebSocketSupported())return this.listener.onFailure(createClientFailure(e.TRANSPORT_NOT_SUPPORTED,{type:"websocket"})),this;try{this.transport.connect()}catch(t){this.logger.error("Fatal transport error ",t);this.listener.onFailure(createClientFailure(e.MALFORMED_URL,{error:t}))}return this}},{key:"subscribe",value:function subscribe(e,t,n){return this.subscriptions.subscribe(e,t,n)}},{key:"transportOptions",value:function transportOptions(){var e={initialReconnectionDelayMs:100,maxReconnectionDelayMs:3e4,reconnectionDelayPowBase:nN,reconnectionJitter:!0};return void 0!==this.options.initialReconnectionDelayMs&&(e.initialReconnectionDelayMs=this.options.initialReconnectionDelayMs),void 0!==this.options.maxReconnectionDelayMs&&(e.maxReconnectionDelayMs=this.options.maxReconnectionDelayMs),void 0!==this.options.reconnectionDelayPowBase&&nN>=1.1&&nN<=2&&(e.reconnectionDelayPowBase=this.options.reconnectionDelayPowBase),e}},{key:"connectionOptions",value:function connectionOptions(){var e={welcomeMaxDelayMs:1e4,welcomeRequestDelayMs:250};return void 0!==this.options.welcomeMaxDelayMs&&(e.welcomeMaxDelayMs=this.options.welcomeMaxDelayMs),e}},{key:"subscriptionOptions",value:function subscriptionOptions(){var e={maxPendingRequests:10,responseMaxDelayMs:1e4,subscribeRetryTimoutMs:3e4,registerDelayMs:250};return void 0!==this.options.maxPendingRequests&&(e.maxPendingRequests=this.options.maxPendingRequests),void 0!==this.options.responseMaxDelayMs&&(e.responseMaxDelayMs=this.options.responseMaxDelayMs),void 0!==this.options.subscribeRetryTimoutMs&&(e.subscribeRetryTimoutMs=this.options.subscribeRetryTimoutMs),void 0!==this.options.registerDelayMs&&(e.registerDelayMs=this.options.registerDelayMs),e}},{key:"getOnConnectObject",value:function getOnConnectObject(){var e=this;return{getId:function getId(){return e.getId()},isAttached:function isAttached(){return e.isAttached()},isAuthenticated:function isAuthenticated(){return e.isAuthenticated()},getQuality:function getQuality(){return e.getQuality()},addQualityListener:function addQualityListener(t){return e.addQualityListener(t)},addCapabilities:function addCapabilities(t){return e.addCapabilities(t)},addActivities:function addActivities(t){return e.addActivities(t)},subscribe:function subscribe(t,n,i){return e.subscribe(t,n,i)}}}},{key:"isWebSocketSupported",value:function isWebSocketSupported(){try{return null!==this.WS||null!==WebSocket}catch(e){return!1}}},{key:"generateId",value:function generateId(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",i=0;i<e;i++)n+=t.charAt(Math.floor(Math.random()*t.length));return n}}],[{key:"getVersion",value:function getVersion(){return Client.version}}])}();_defineProperty(nB,"version","1.5.1");var nz={connect:function connect(e,t,n){return new nB(e,t,n).connect()}};class nF{subscriptions=[];on(e,t){this.subscriptions.push({eventName:e,handler:t})}off(e,t){this.subscriptions=this.subscriptions.filter(n=>n.eventName!==e||n.handler!==t)}emit(e,t){this.subscriptions.filter(t=>t.eventName===e).forEach(e=>e.handler(t))}}let nL={CONNECT:"connect",DISCONNECT:"disconnect",FAILURE:"failure",RECONNECT:"reconnect"};window.chesscom.clientMetrics??={};window.chesscom.clientMetrics.queue??=[];function recordRuntimeMetric(e,t,n){window.chesscom.clientMetrics?.recordRuntimeMetricImpl?window.chesscom.clientMetrics.recordRuntimeMetricImpl(e,t,n):window.chesscom.clientMetrics?.enabled&&window.chesscom.clientMetrics.queue?.push({eventType:e,value:t,startTime:n})}let nq=!1;!function connect(){let e=window.context?.user?.uuid,t=window.PubSub?.options?.url?.pubsub;if(!t)throw Error("PubSub.options.url.pubsub is missing");let n=new nF;window.PubSub.on=n.on.bind(n);window.PubSub.off=n.off.bind(n);window.PubSub.client=nz.connect({debug:!1,uid:e,url:t},{onAttach:()=>{n.emit(nL.RECONNECT)},onConnect:()=>{n.emit(nL.CONNECT);if(!nq){recordRuntimeMetric("timeToPubsub",performance.now());nq=!0}},onDetach:()=>{n.emit(nL.DISCONNECT)},onFailure:e=>{n.emit(nL.FAILURE,{failure:e})}});window.addEventListener("pagehide",()=>{window.PubSub.client.close()});window.addEventListener("online",()=>{window.PubSub.client.setOnline(!0)});window.addEventListener("offline",()=>{window.PubSub.client.setOnline(!1)})}()}()}();